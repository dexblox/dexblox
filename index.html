<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Beli Robux - DEXBLOX.ID</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {margin:0;font-family:Arial,sans-serif;background:#f6fff6;color:#222;font-size:14px;}
    header {background:#00c853;color:#fff;padding:12px;text-align:center;border-bottom:2px solid #00e676;}
    header h1 {margin:0;font-size:20px;}
    .container {max-width:95%;margin:12px auto;background:#fff;border:1px solid #00c853;border-radius:8px;padding:10px;box-shadow:0 0 6px #00c85333;}
    .panel {margin-bottom:12px;padding:10px;border:1px solid #00c85333;border-radius:6px;background:#fdfdfd;}
    .panel h3 {margin:0 0 8px;color:#00c853;font-size:14px;text-align:center;border-bottom:1px solid #00c85333;padding-bottom:4px;}
    input, button {width:90%;max-width:250px;padding:6px;font-size:13px;border-radius:6px;margin:6px auto;display:block;}
    .info {margin-top:6px;font-size:12px;color:#00c853;font-weight:bold;text-align:center;}
    .quick-prices {display:grid;grid-template-columns:1fr 1fr;gap:8px;}
    .quick-prices button {background:#e0f7fa;border:1px solid #00c853;font-size:12px;font-weight:bold;}
    .quick-prices button:hover {background:#00e676;color:#fff;}
    .deskripsi {font-size:12px;line-height:1.4;}
    .garansi {margin-top:10px;font-size:12px;color:#00c853;text-align:center;}
    button.submit {background:#00c853;color:#fff;border:none;font-weight:bold;}
    button.submit:hover {background:#00e676;box-shadow:0 0 8px #00e676;}
    img.qris {width:100%;border:1px solid #00c853;border-radius:6px;}
    #topupNotif {margin-top:8px;padding:6px;border-radius:5px;font-size:12px;font-weight:bold;text-align:center;background:#e0f7fa;border:1px solid #00c853;color:#222;display:none;}
    .floating-btn {position:fixed;top:15px;right:15px;background:#00c853;color:#fff;border:none;border-radius:50%;width:36px;height:36px;font-size:16px;z-index:3;}
    .admin-panel {position:fixed;top:60px;right:15px;background:#ffffff;border:1px solid #00c853;border-radius:6px;padding:8px;width:180px;display:none;z-index:3;font-size:12px;}
  </style>
</head>
<body>
  <header><h1>Beli Robux</h1></header>

  <div class="container">
    <!-- Username + Avatar -->
    <div class="panel">
      <h3>üë§ Username Roblox</h3>
      <input type="text" id="username" placeholder="Username Roblox">
      <button onclick="cekUsername()">üîç Cek Username</button>
      <div id="userInfo" style="margin-top:6px;text-align:center;font-size:12px;color:#00c853;"></div>
    </div>

    <!-- Paket Cepat -->
    <div class="panel">
      <h3>‚ö° Pilihan Cepat Paket Robux</h3>
      <div class="quick-prices">
        <button onclick="pilihPaket(100,11000,143)">100 RBX<br>Rp11.000</button>
        <button onclick="pilihPaket(300,33000,429)">300 RBX<br>Rp33.000</button>
        <button onclick="pilihPaket(500,55000,715)">500 RBX<br>Rp55.000</button>
        <button onclick="pilihPaket(1000,110000,1430)">1000 RBX<br>Rp110.000</button>
      </div>
    </div>

    <!-- Jumlah Robux -->
    <div class="panel">
      <h3>üí∞ Jumlah Robux</h3>
      <input type="number" id="jumlahRobux" oninput="hitungManual()">
      <p class="info">Harga: Rp<span id="hargaPer100">11.000</span> / 100 RBX</p>
      <p class="info" id="setIdInfo">Set ID: -</p>
      <input type="text" id="totalRp" readonly>
    </div>

    <!-- Deskripsi -->
    <div class="panel">
      <h3>üìÑ Deskripsi Produk</h3>
      <div class="deskripsi">
        Top up Robux (RBX) terpercaya dan termurah. Garansi pembelian 100% aman, harga terjangkau, dan robux pasti masuk ke akun kamu.
      </div>
    </div>

    <!-- QRIS -->
    <div class="panel">
      <h3>üí≥ Pembayaran QRIS</h3>
      <img src="/qris.png" alt="QRIS Dexblox" class="qris">
    </div>

    <!-- Konfirmasi -->
    <div class="panel">
      <h3>üöÄ Konfirmasi</h3>
      <button class="submit" onclick="konfirmasiWA()">Lanjutkan Pembelian</button>
      <div id="topupNotif">üöÄ Permintaan Topup dikirim ke Admin Dexblox!</div>
      <div class="garansi">‚úÖ Garansi 100% Robux Masuk dan Aman</div>
    </div>
  </div>

  <!-- Admin Panel -->
  <button class="floating-btn" onclick="toggleAdmin()">üîë</button>
  <div id="adminPanelBox" class="admin-panel">
    <h3 style="margin:0; font-size:13px; color:#00c853;">Admin Login</h3>
    <input type="password" id="adminPass" placeholder="Kode admin">
    <button onclick="adminLogin()">Login</button>
    <p id="adminResult"></p>
    <div id="adminPanel" style="display:none; margin-top:6px;">
      <label for="newPrice">Harga/100 Robux:</label>
      <input type="number" id="newPrice" placeholder="11000">
      <button onclick="updatePrice()">Update</button>
    </div>
  </div>

<script>
const base = "https://dexblox.vercel.app"; // ganti sesuai domain Vercel kamu

async function cekUsername() {
  const username = document.getElementById('username').value.trim();
  const userInfo = document.getElementById('userInfo');
  userInfo.innerHTML = "";
  if (!username) return;

  try {
    const res = await fetch(`${base}/api/user?username=${encodeURIComponent(username)}`);
    const data = await res.json();

    if (data && data.id) {
      const avatarRes = await fetch(`${base}/api/avatar?userId=${data.id}`);
      const avatarData = await avatarRes.json();

      userInfo.innerHTML = `
        ‚úÖ <b>${data.displayName}</b><br>
        <img src="${avatarData.imageUrl}" alt="Avatar Roblox"
             style="margin-top:6px;border:1px solid #00c853;
             border-radius:6px;width:80px;height:80px;">
      `;
    } else {
      userInfo.innerHTML = "‚ùå Username tidak ditemukan!";
    }
  } catch {
    userInfo.innerHTML = "‚ö†Ô∏è Gagal cek username!";
  }
}

function pilihPaket(robux, harga, setId) {
  document.getElementById('jumlahRobux').value = robux;
  document.getElementById('totalRp').value = `Rp${harga.toLocaleString()}`;
  document.getElementById('setIdInfo').innerText = `Set ID: ${setId}`;
}

function hitungManual() {
  const robux = parseInt(document.getElementById('jumlahRobux').value);
  if (!robux) {
    document.getElementById('totalRp').value = "";
    document.getElementById('setIdInfo').innerText = "Set ID: -";
    return;
  }
  const harga = (robux / 100) * parseInt(document.getElementById('hargaPer100').innerText.replace(/\./g,''));
  const setIdList = [143,286,429,572,715,858,1001,1144,1287,1430];
  let nearest = setIdList[0];
  let minDiff = Math.abs(robux - nearest);
  for (let i = 1; i < setIdList.length; i++) {
    let diff = Math.abs(robux - setIdList[i]);
    if (diff < minDiff) {
      minDiff = diff;
      nearest = setIdList[i];
    }
  }
  document.getElementById('totalRp').value = `Rp${harga.toLocaleString()}`;
  document.getElementById('setIdInfo').innerText = `Set ID: ${nearest}`;
}

function konfirmasiWA() {
  const username = document.getElementById('username').value.trim();
  const robux = document.getElementById('jumlahRobux').value;
  const total = document.getElementById('totalRp').value;
  const setId = document.getElementById('setIdInfo').innerText;

  if (!username || !robux) {
    alert("‚ö†Ô∏è Lengkapi username dan jumlah Robux!");
    return;
  }

  const message = `Halo Admin Dexblox,
Topup ${robux} Robux (${total}) untuk ${username}.
${setId}
Pembayaran via QRIS. Bukti pembayaran sudah dikirim user.`;

  const phone = "6285362187740"; // nomor WA admin
  const waUrl = `https://wa.me/${phone}?text=${encodeURIComponent(message)}`;
  window.open(waUrl, "_blank");

  const notif = document.getElementById('topupNotif');
  notif.style.display = "block";
  setTimeout(() => { notif.style.display = "none"; }, 4000);
}

function toggleAdmin() {
  const panel = document.getElementById('adminPanelBox');
  panel.style.display = panel.style.display === "none" ? "block" : "none";
}

function adminLogin() {
  const pass = document.getElementById('adminPass').value;
  const result = document.getElementById('adminResult');
  if (pass === "dexblox123") {
    result.innerText = "‚úÖ Login sukses!";
    document.getElementById('adminPanel').style.display = "block";
  } else {
    result.innerText = "‚ùå Kode salah!";
  }
}

function updatePrice() {
  const newPrice = document.getElementById('newPrice').value;
  if (!newPrice) return;
  document.getElementById('hargaPer100').innerText = parseInt(newPrice).toLocaleString();
  alert("‚úÖ Harga berhasil diupdate!");
  hitungManual();
}
</script>
</body>
</html>
