<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Beli Robux - DEXBLOX.ID</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      margin:0;
      font-family:'Poppins',sans-serif;
      background:linear-gradient(to bottom,#fff,#e0e0e0);
      color:#222;
      overflow:auto;
    }
    header {background:rgba(0,200,83,0.4);color:#fff;padding:15px;text-align:center;
      border-bottom:2px solid #00e676;box-shadow:0 4px 12px rgba(0,0,0,0.2);
      position:relative;z-index:2;backdrop-filter:blur(6px);}
    header h1 {margin:0;font-size:22px;font-weight:600;}
    .container {max-width:95%;margin:20px auto;background:transparent;border-radius:12px;
      padding:15px;position:relative;z-index:2;}
    .panel {margin-bottom:15px;padding:12px;border-radius:10px;background:transparent;
      box-shadow:none;border:1px solid rgba(0,200,83,0.3);}
    .panel h3 {margin:0 0 10px;color:#00c853;font-size:15px;text-align:center;font-weight:600;}
    input,button {width:90%;max-width:260px;padding:8px;font-size:13px;border-radius:8px;
      margin:6px auto;display:block;border:1px solid #00c853;font-family:'Poppins',sans-serif;
      background:rgba(255,255,255,0.85);color:#222;}
    button {background:#e0f7fa;font-weight:600;transition:all 0.3s ease;}
    button:hover {transform:scale(1.05);box-shadow:0 0 12px #00e676;background:#00e676;color:#fff;}
    .info {margin-top:6px;font-size:12px;color:#00c853;font-weight:bold;text-align:center;}
    .quick-prices {display:grid;grid-template-columns:1fr 1fr;gap:10px;}
    .deskripsi {font-size:12px;line-height:1.5;text-align:center;}
    .garansi {margin-top:10px;font-size:12px;color:#00c853;text-align:center;font-weight:600;}
    button.submit {background:#00c853;color:#fff;}
    button.submit:hover {background:#00e676;box-shadow:0 0 12px #00e676;}
    img.qris {width:100%;border:1px solid #00c853;border-radius:8px;}
    #topupNotif {
      margin-top:8px;
      padding:10px;
      border-radius:10px;
      font-size:13px;
      font-weight:600;
      text-align:center;
      background:linear-gradient(to right,#00c853,#00e676);
      border:2px solid #00c853;
      color:#fff;
      display:none;
      animation: munculNotif 0.5s ease-out;
      box-shadow:0 0 12px rgba(0,200,83,0.6);
    }
    @keyframes munculNotif {
      from {opacity:0; transform:scale(0.9);}
      to {opacity:1; transform:scale(1);}
    }
    .floating-btn {position:fixed;top:15px;right:15px;background:#00c853;color:#fff;border:none;
      border-radius:50%;width:40px;height:40px;font-size:18px;z-index:3;box-shadow:0 4px 12px rgba(0,0,0,0.2);
      transition:all 0.3s ease;}
    .floating-btn:hover {transform:scale(1.1);box-shadow:0 0 12px #00e676;}
    .admin-panel {position:fixed;top:70px;right:15px;background:transparent;border:1px solid #00c853;
      border-radius:10px;padding:10px;width:200px;display:none;z-index:3;font-size:12px;}
    #particles {position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:1;}
  </style>
</head>
<body>
  <canvas id="particles"></canvas>
  <header><h1>Beli Robux - DEXBLOX.ID</h1></header>

  <div class="container">
    <div class="panel">
      <h3>üë§ Username Roblox</h3>
      <input type="text" id="username" placeholder="Masukkan Username Roblox">
      <button onclick="cekUsername()">üîç Cek Username</button>
      <div id="userInfo" style="margin-top:6px;text-align:center;font-size:12px;color:#00c853;"></div>
    </div>

    <div class="panel">
      <h3>‚ö° Pilihan Cepat Paket Robux</h3>
      <div class="quick-prices">
        <button onclick="pilihPaket(100,143)">100 RBX</button>
        <button onclick="pilihPaket(300,429)">300 RBX</button>
        <button onclick="pilihPaket(500,715)">500 RBX</button>
        <button onclick="pilihPaket(1000,1430)">1000 RBX</button>
      </div>
    </div>

    <div class="panel">
      <h3>üí∞ Jumlah Robux</h3>
      <input type="number" id="jumlahRobux" oninput="hitungManual()">
      <p class="info">Harga: Rp<span id="hargaPer100">11.000</span> / 100 RBX</p>
      <p class="info" id="setIdInfo">Set ID: -</p>
      <input type="text" id="totalRp" readonly>
    </div>

    <div class="panel" style="text-align:center;">
      <button class="submit" onclick="konfirmasiWA()">üì≤ Kirim via WhatsApp</button>
    </div>

    <div class="panel">
      <h3>üìÑ Deskripsi Produk</h3>
      <div class="deskripsi">
        Top up Robux (RBX) terpercaya dan termurah. Garansi pembelian 100% aman, harga terjangkau, dan robux pasti masuk ke akun kamu.
      </div>
    </div>

    <div class="panel">
      <h3>üí≥ Pembayaran QRIS</h3>
      <img src="/qris.png" alt="QRIS Dexblox" class="qris">
    </div>

    <div class="panel">
      <h3>üöÄ Konfirmasi</h3>
      <button class="submit" onclick="konfirmasiWA()">Lanjutkan Pembelian</button>
      <div id="topupNotif">üöÄ Permintaan Topup dikirim ke Admin Dexblox!</div>
      <div class="garansi">‚úÖ Garansi 100% Robux Masuk dan Aman</div>
    </div>
  </div>

  <button class="floating-btn" onclick="toggleAdmin()">üîë</button>
  <div id="adminPanelBox" class="admin-panel">
    <h3 style="margin:0; font-size:13px; color:#00c853;">Admin Login</h3>
    <input type="password" id="adminPass" placeholder="Kode admin">
    <button onclick="adminLogin()">Login</button>
    <p id="adminResult"></p>
    <div id="adminPanel" style="display:none; margin-top:6px;">
      <label for="newPrice">Harga/100 Robux:</label>
      <input type="number" id="newPrice" placeholder="11000">
      <button onclick="updatePrice()">Update</button>
    </div>
  </div>

<script>
window.onload = () => {
  const savedPrice = localStorage.getItem("hargaPer100");
  if (savedPrice) {
    document.getElementById('hargaPer100').innerText = parseInt(savedPrice).toLocaleString();
  }
};

async function cekUsername() {
  const username = document.getElementById('username').value.trim();
  const userInfo = document.getElementById('userInfo');
  userInfo.innerHTML = "";
  if (!username) {
    userInfo.innerHTML = "‚ö†Ô∏è Lengkapi username terlebih dahulu!";
    return;
  }

  try {
    const res = await fetch(`/api/user?username=${encodeURIComponent(username)}`);
    const data = await res.json();

    if (data && data.id) {
      const avatarRes = await fetch(`/api/avatar?userId=${data.id}`);
      const avatarData = await avatarRes.json();

      const gamesRes = await fetch(`/api/games?userId=${data.id}`);
      const gamesData = await gamesRes.json();

      let gameLinks = "";
      if (gamesData.games && gamesData.games.length > 0) {
        gameLinks = gamesData.games.map(g =>
          `<a href="${g.link}" target="_blank" style="color:#00c853;font-size:12px;">üéÆ ${g.name}</a>`
        ).join("<br>");
      } else {
        gameLinks = "‚ùå User belum punya game.";
      }

      userInfo.innerHTML = `
        ‚úÖ <b>${data.displayName}</b><br>
        <img src="${avatarData.imageUrl}" alt="Avatar Roblox"
             style="margin-top:6px;border:1px solid #00c853;
             border-radius:6px;width:80px;height:80px;"><br>
        üîó <a href="https://www.roblox.com/users/${data.id}/profile" 
              target="_blank" style="color:#00c853;font-size:12px;">
              Lihat Profile User
        </a><br>
        ${gameLinks}
      `;
    } else {
      userInfo.innerHTML = "‚ùå Username tidak ditemukan!";
    }
  } catch {
    userInfo.innerHTML = "‚ö†Ô∏è Gagal cek username!";
  }
}

// ‚ö° Pilih Paket
function pilihPaket(robux, setId) {
  const hargaPer100 = parseInt(document.getElementById('hargaPer100').innerText.replace(/\./g,''));
  const harga = (robux / 100) * hargaPer100;
  document.getElementById('jumlahRobux').value = robux;
  document.getElementById('totalRp').value = `Rp${harga.toLocaleString()}`;
  document.getElementById('setIdInfo').innerText = `Set ID: ${setId}`;
}

// üí∞ Hitung Manual
function hitungManual() {
  const robux = parseInt(document.getElementById('jumlahRobux').value);
  if (!robux) {
    document.getElementById('totalRp').value = "";
    document.getElementById('setIdInfo').innerText = "Set ID: -";
    return;
  }
  const hargaPer100 = parseInt(document.getElementById('hargaPer100').innerText.replace(/\./g,''));
  const harga = (robux / 100) * hargaPer100;
  document.getElementById('totalRp').value = `Rp${harga.toLocaleString()}`;
  document.getElementById('setIdInfo').innerText = `Set ID: ${robux}`;
}

// üöÄ Konfirmasi WA + Notifikasi Keren
function konfirmasiWA() {
  const username = document.getElementById('username').value.trim();
  const robux = document.getElementById('jumlahRobux').value;
  const total = document.getElementById('totalRp').value;
  const setId = document.getElementById('setIdInfo').innerText;

  if (!username || !robux) {
    alert("‚ö†Ô∏è Lengkapi username dan jumlah Robux!");
    return;
  }

  const message = `Halo Admin Dexblox,
Topup ${robux} Robux (${total}) untuk ${username}.
${setId}
Pembayaran via QRIS. Bukti pembayaran sudah dikirim user.`;

  const phone = "6285362187740"; // nomor WA admin
  const waUrl = `https://wa.me/${phone}?text=${encodeURIComponent(message)}`;
  window.open(waUrl, "_blank");

  const notif = document.getElementById('topupNotif');
  notif.innerText = "‚úÖ Topup kamu sedang diproses! Admin Dexblox akan segera kirim Robux.";
  notif.style.display = "block";
  notif.style.animation = "munculNotif 0.5s ease-out";
  setTimeout(() => { notif.style.display = "none"; }, 5000);
}

// üîë Admin Panel
function toggleAdmin() {
  const panel = document.getElementById('adminPanelBox');
  panel.style.display = panel.style.display === "none" ? "block" : "none";
}
function adminLogin() {
  const pass = document.getElementById('adminPass').value;
  const result = document.getElementById('adminResult');
  if (pass === "dexblox123") {
    result.innerText = "‚úÖ Login sukses!";
    document.getElementById('adminPanel').style.display = "block";
  } else {
    result.innerText = "‚ùå Kode salah!";
  }
}
function updatePrice() {
  const newPrice = document.getElementById('newPrice').value;
  if (!newPrice) return;
  localStorage.setItem("hargaPer100", newPrice);
  document.getElementById('hargaPer100').innerText = parseInt(newPrice).toLocaleString();
  alert("‚úÖ Harga berhasil diupdate!");
  hitungManual();
}

// üåø Efek Partikel Hijau Bergerak
const canvasParticles = document.getElementById("particles");
const ctxP = canvasParticles.getContext("2d");
canvasParticles.width = window.innerWidth;
canvasParticles.height = window.innerHeight;
let particlesArray = [];
function initParticles() {
  for (let i = 0; i < 80; i++) {
    particlesArray.push({
      x: Math.random() * canvasParticles.width,
      y: Math.random() * canvasParticles.height,
      radius: Math.random() * 2 + 1,
      dx: (Math.random() - 0.5) * 0.5,
      dy: (Math.random() - 0.5) * 0.5
    });
  }
}
function drawParticles() {
  ctxP.clearRect(0, 0, canvasParticles.width, canvasParticles.height);
  ctxP.fillStyle = "rgba(0, 200, 83, 0.6)";
  ctxP.beginPath();
  particlesArray.forEach(p => {
    ctxP.moveTo(p.x, p.y);
    ctxP.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
  });
  ctxP.fill();
  moveParticles();
}
function moveParticles() {
  particlesArray.forEach(p => {
    p.x += p.dx;
    p.y += p.dy;
    if (p.x < 0 || p.x > canvasParticles.width) p.dx *= -1;
    if (p.y < 0 || p.y > canvasParticles.height) p.dy *= -1;
  });
}
initParticles();
setInterval(drawParticles, 30);
</script>
</body>
</html>
