<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, maximum-scale=1.0, user-scalable=no">
  <title>DEXBLOX - Topup Robux</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background:#fff;font-family:Arial,sans-serif;color:#000; }
    h1,h2,h3,p,label { color:#000;text-shadow:none; }
    .paket-card {transition:.3s;cursor:pointer;background:rgba(0,0,0,0.05);color:#000;border:2px solid transparent;border-radius:8px;}
    .paket-card:hover {transform:scale(1.03);background:rgba(0,0,0,0.1);}
    .paket-card.active {background:#000;color:#fff;border:2px solid #000;}
    .panel-buttons button.active {background:#000;color:#fff;}
    .panel-box {background:rgba(255,255,255,0.9);border:2px solid #000;border-radius:12px;}
    footer {color:#000;}
    .panel-link {color:#007bff;font-weight:bold;text-decoration:none;}
    .panel-link:hover {text-decoration:underline;}
    @keyframes coinBounce {0%,100%{transform:translateY(0);}50%{transform:translateY(-20px) scale(1.05);}}
    .logo-coin {animation:coinBounce 2s infinite ease-in-out;}
    #notifPanel {display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);align-items:center;justify-content:center;z-index:50;}
    #notifContent {background:#fff;padding:20px;border-radius:12px;max-width:400px;text-align:center;}
  </style>
</head>
<body class="flex flex-col items-center min-h-screen relative">

<header class="z-10 text-center mt-6 mb-6">
  <img src="dexblox.png" alt="DEXBLOX Logo" class="logo-coin mx-auto mb-4 w-24 h-24">
  <h1 class="text-5xl font-extrabold">DEXBLOX</h1>
  <div class="rating mt-2">Topup Robux Termurah Di Indonesia</div>
</header>

<!-- Panel Buttons -->
<div class="panel-buttons flex justify-center space-x-4 mt-4 z-10">
  <button id="btn5hari" class="active px-4 py-2 rounded">Robux 5 Hari</button>
  <button id="btnLangsung" class="px-4 py-2 rounded">Via Login</button>
  <button id="btnKomunitas" class="px-4 py-2 rounded">Via Komunitas</button>
</div>

<!-- Promo Panel -->
<div id="promoPanel" class="mt-4">
  <a href="https://dexstore.webkus.com/" target="_blank" class="panel-link">Game lainnya Klik</a>
</div>

<!-- Panel 5 Hari -->
<div id="panel5hari" class="panel-box mt-6 z-10 w-[90%] max-w-md p-6 rounded-xl shadow-lg text-center">
  <h2 class="text-2xl font-bold mb-4">Robux 5 Hari</h2>
  <form id="topupForm" class="space-y-6">
    <label class="block mb-1">Username Roblox</label>
    <input type="text" id="username" class="w-full p-2 rounded border text-center" placeholder="Masukkan Username Roblox">
    <p id="notifUsername" class="text-xs mt-1"></p>
    <div class="mt-4 text-center">
      <img id="avatarPreview" class="hidden mx-auto rounded-full border" width="120" height="120" alt="Avatar Roblox">
    </div>
    <button type="button" id="btnCekUser" class="bg-black text-white font-bold px-4 py-2 rounded mt-2">Cek Username</button>

    <h3 class="text-lg font-bold mt-4 mb-2">Harga Hari Ini</h3>
    <p class="mb-4">Rp <span id="hargaHariIni" data-harga="13000" class="text-2xl font-extrabold">13.000</span> = 100 Robux</p>
    <div class="grid grid-cols-2 gap-4">
      <div class="paket-card p-4 rounded-lg font-bold" data-value="100">100 Robux</div>
      <div class="paket-card p-4 rounded-lg font-bold" data-value="200">200 Robux</div>
      <div class="paket-card p-4 rounded-lg font-bold" data-value="500">500 Robux</div>
      <div class="paket-card p-4 rounded-lg font-bold" data-value="1000">1000 Robux</div>
    </div>
    <p id="notifPaket" class="text-xs mt-1"></p>

    <h3 class="text-lg font-bold mt-4 mb-2">Custom Paket Robux</h3>
    <input type="number" id="customRobux" class="p-2 rounded border text-center w-48" placeholder="Jumlah Robux">
    <p id="notifCustom" class="text-xs mt-1"></p>

    <p id="paketInfo" class="font-bold mt-2"></p>
    <input type="hidden" id="robux" name="robux">

    <label class="block mb-1 mt-4">Kode Promo</label>
    <div class="flex space-x-2">
      <input type="text" id="promoInput" class="flex-1 p-2 rounded border text-center" placeholder="Masukkan kode promo">
      <button type="button" id="btnPromo" class="bg-black text-white font-bold px-4 rounded">Cek</button>
    </div>
    <p id="notifPromo" class="text-xs mt-1"></p>

    <button type="submit" class="w-full bg-black text-white font-bold py-2 px-4 rounded shadow-lg">Topup</button>
  </form>
</div>

<!-- Panel Login -->
<div id="panelLogin" class="hidden panel-box mt-6 z-10 w-[90%] max-w-md p-6 rounded-xl shadow-lg text-center">
  <h2 class="text-2xl font-bold mb-4">Via Login</h2>
  <label class="block mb-1">Username Roblox</label>
  <input type="text" id="loginUsername" class="w-full p-2 rounded border text-center" placeholder="Masukkan Username Roblox">
  <p id="loginNotifUser" class="text-xs mt-1"></p>
  <div class="mt-4 text-center">
    <img id="loginAvatar" class="hidden mx-auto rounded-full border" width="120" height="120" alt="Avatar Roblox">
  </div>
  <button type="button" id="btnLoginCekUser" class="bg-black text-white font-bold px-4 py-2 rounded mt-2">Cek Username</button>

  <h3 class="text-lg font-bold mt-6 mb-2">Paket Premium</h3>
  <div class="grid grid-cols-2 gap-4">
    <div class="paket-card p-4 rounded-lg font-bold" data-type="premium" data-value="450">450 Robux</div>
    <div class="paket-card p-4 rounded-lg font-bold" data-type="premium" data-value="1000">1000 Robux</div>
    <div class="paket-card p-4 rounded-lg font-bold" data-type="premium" data-value="2200">2200 Robux</div>
  </div>

  <h3 class="text-lg font-bold mt-6 mb-2">Paket Robux</h3>
  <div class="grid grid-cols-2 gap-4">
    <div class="paket-card p-4 rounded-lg font-bold" data-type="robux" data-value="240">240 Robux</div>
    <div class="paket-card p-4 rounded-lg font-bold" data-type="robux" data-value="500">500 Robux</div>
    <div class="paket-card p-4 rounded-lg font-bold" data-type="robux" data-value="1000">1000 Robux</div>
  </div>

  <p id="loginPaketInfo" class="font-bold mt-4"></p>
  <button id="btnLoginTopup" class="w-full bg-black text-white font-bold py-2 px-4 rounded shadow-lg mt-4">Topup</button>
</div>

<!-- Panel Komunitas -->
<div id="panelKomunitas" class="hidden panel-box mt-6 z-10 w-[90%] max-w-md p-6 rounded-xl shadow-lg text-center">
  <h2 class="text-2xl font-bold mb-4">Via Komunitas</h2>
  <p>COMING SOON</p>
</div>

<!-- Admin Panel -->
<div id="adminModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
  <div class="panel-box p-6 rounded-lg shadow-lg text-center max-w-sm border border-black">
    <h2 class="font-bold text-lg mb-4">Admin Panel</h2>
    <input type="password" id="adminPassword" class="w-full p-2 rounded border text-center mb-4" placeholder="••••••••">
    <div id="adminTools" class="hidden">
      <button id="btnLogoutAdmin" class="bg-gray-500 text-white px-4 py-2 rounded mt-2">Logout</button>
      <h3 class="font-bold mt-6 mb-2">Kirim Bukti ke User</h3>
      <input type="text" id="adminUser" placeholder="Username Roblox" class="w-full p-2 rounded border mb-2">
      <button id="btnAdminCekUser" class="bg-black text-white font-bold px-4 py-2 rounded mb-2">Cek Username</button>
      <img id="adminAvatar" class="hidden mx-auto mb-2 rounded-full border" width="100" height="100" alt="Avatar Roblox">
      <p id="adminNotifUser" class="text-xs mb-2"></p>
      <input type="text" id="adminRobux" placeholder="Jumlah Robux" class="w-full p-2 rounded border mb-2">
      <input type="text" id="adminWA" placeholder="Nomor WhatsApp User (62...)" class="w-full p-2 rounded border mb-2">
      <button id="btnAdminBayar" class="bg-black text-white px-4 py-2 rounded">Buat Invoice Pakasir</button>
    </div>
    <div class="flex justify-center space-x-4 mt-4">
      <button id="btnCloseAdmin" class="bg-red-500 text-white px-4 py-2 rounded">Tutup</button>
      <button id="btnLoginAdmin" class="bg-green-500 text-white px-4 py-2 rounded">Login</button>
    </div>
  </div>
</div>

<!-- Mini Admin Button -->
<div class="fixed bottom-2 right-2 bg-gray-200 p-1 rounded-lg shadow-lg">
  <button id="adminToggleBtn" class="relative bg-black text-white px-2 py-1 rounded-full shadow-lg text-sm">⋮</button>
</div>

<!-- Notifikasi Konfirmasi -->
<div id="notifPanel">
  <div id="notifContent"></div>
</div>

<!-- Footer -->
<footer class="text-center mt-12 mb-4 text-sm w-full">
  © <span id="fullDate"></span> DEXBLOX All Rights Reserved
</footer>

<script>
document.addEventListener("DOMContentLoaded", () => {
  // ===== Variabel Harga =====
  let hargaPer100 = 13000; // harga dasar per 100 Robux
  let promoActive = false; // status promo

  // ===== Fungsi Hitung Harga =====
  function hitungHarga(robux){
    let harga = (robux / 100) * hargaPer100;
    if(promoActive){
      harga = Math.round(harga * 0.9); // diskon 10%
    }
    const gamepassId = Math.round((robux / 100) * 143);
    return { harga, gamepassId };
  }

  // ===== Panel Toggle =====
  function showPanel(panelId){
    ["panel5hari","panelLogin","panelKomunitas"].forEach(id=>{
      const el=document.getElementById(id);
      if(el) el.classList.add("hidden");
    });
    document.getElementById(panelId).classList.remove("hidden");
    document.querySelectorAll(".panel-buttons button").forEach(btn=>btn.classList.remove("active"));
    let btnId = panelId==="panel5hari"?"btn5hari":panelId==="panelLogin"?"btnLangsung":"btnKomunitas";
    document.getElementById(btnId).classList.add("active");
  }
  document.getElementById("btn5hari").onclick=()=>showPanel("panel5hari");
  document.getElementById("btnLangsung").onclick=()=>showPanel("panelLogin");
  document.getElementById("btnKomunitas").onclick=()=>showPanel("panelKomunitas");

  // ===== Paket Card Toggle =====
  function bindPaketCards(panelId, infoId){
    document.querySelectorAll(`#${panelId} .paket-card`).forEach(card=>{
      card.addEventListener("click",()=>{
        document.querySelectorAll(`#${panelId} .paket-card`).forEach(c=>c.classList.remove("active"));
        card.classList.add("active");
        const robux=parseInt(card.dataset.value);
        const { harga, gamepassId } = hitungHarga(robux);
        document.getElementById(infoId).textContent=`${robux} Robux = Rp${harga.toLocaleString("id-ID")} (Gamepass: ${gamepassId})`;
        document.getElementById(infoId).dataset.value=robux;
      });
    });
  }
  bindPaketCards("panel5hari","paketInfo");
  bindPaketCards("panelLogin","loginPaketInfo");

  // ===== Promo =====
  document.getElementById("btnPromo").addEventListener("click",()=>{
    const input=document.getElementById("promoInput").value.trim().toUpperCase();
    if(input==="DEX10OFF"){
      promoActive=true;
      document.getElementById("notifPromo").textContent="Kode Promo Valid, diskon aktif.";
      document.getElementById("notifPromo").style.color="green";
    } else {
      promoActive=false;
      document.getElementById("notifPromo").textContent="Kode Promo Salah.";
      document.getElementById("notifPromo").style.color="red";
    }
  });

  // ===== Cek Username (dummy) =====
  async function cekUsernameGeneric(inputId, notifId, avatarId){
    const username=document.getElementById(inputId).value.trim();
    if(!username){
      document.getElementById(notifId).textContent="Harap isi Username Roblox!";
      return;
    }
    try{
      const res=await fetch("/api/user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username})});
      const data=await res.json();
      if(res.ok){
        document.getElementById(notifId).textContent="Username ditemukan: "+data.name;
        const resAvatar=await fetch(`/api/avatar?userId=${data.userId}`);
        const dataAvatar=await resAvatar.json();
        if(resAvatar.ok && dataAvatar.avatarUrl){
          const avatar=document.getElementById(avatarId);
          avatar.src=dataAvatar.avatarUrl;
          avatar.classList.remove("hidden");
        }
      } else {
        document.getElementById(notifId).textContent="Error: "+data.error;
      }
    }catch(err){
      document.getElementById(notifId).textContent="Gagal cek username";
    }
  }

  // ===== Konfirmasi Topup =====
  function konfirmasiTopup(username, robux, avatarId, notifTitle){
    const panel=document.getElementById("notifPanel");
    const content=document.getElementById("notifContent");
    panel.style.display="flex";
    const now=new Date().toLocaleString("id-ID");
    const avatarSrc=document.getElementById(avatarId).src;
    content.innerHTML=`
      <h3 class="font-bold mb-4">${notifTitle}</h3>
      <img src="${avatarSrc}" class="mx-auto mb-4 rounded-full border" width="120" height="120">
      <p class="mb-4">
        Username: <span class="font-bold">${username}</span><br>
        Paket: <span class="font-bold">${robux} Robux</span><br>
        Waktu: ${now}
      </p>
      <div class="flex justify-center space-x-4">
        <button id="btnConfirmPay" class="bg-green-500 text-white px-4 py-2 rounded">Bayar via Pakasir</button>
        <button id="btnCancel" class="bg-red-500 text-white px-4 py-2 rounded">Batal</button>
      </div>`;
    document.getElementById("btnConfirmPay").onclick=()=>buatInvoicePakasir(username,robux);
    document.getElementById("btnCancel").onclick=()=>{panel.style.display="none";}
  }

  // ===== Buat Invoice =====
  async function buatInvoicePakasir(username, robux){
    try{
      const res=await fetch("/api/invoice",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username,robux})});
      const data=await res.json();
      if(res.ok && data.checkout_url){
        window.open(data.checkout_url,"_blank");
      } else {
        alert("Gagal membuat invoice: "+(data.error||"Unknown error"));
      }
    }catch(err){
      alert("Terjadi kesalahan server");
    }
  }

  // ===== Binding Panel 5 Hari =====
  document.getElementById("btnCekUser").onclick=()=>cekUsernameGeneric("username","notifUsername","avatarPreview");
  document.getElementById("topupForm").onsubmit=(e)=>{
    e.preventDefault();
    const username=document.getElementById("username").value.trim();
    const robux=document.getElementById("paketInfo").dataset.value;
    if(!username||!robux){alert("Lengkapi data!");return;}
    konfirmasiTopup(username,robux,"avatarPreview","Konfirmasi Topup 5 Hari");
  };

  // ===== Binding Panel Login =====
  document.getElementById("btnLoginCekUser").onclick=()=>cekUsernameGeneric("loginUsername","loginNotifUser","loginAvatar");
  document.getElementById("btnLoginTopup").onclick=()=>{
    const username=document.getElementById("loginUsername").value.trim();
    const robux=document.getElementById("loginPaketInfo").dataset.value;
    if(!username||!robux){alert("Lengkapi data!");return;}
    konfirmasiTopup(username,robux,"loginAvatar","Konfirmasi Topup Login");
  };

// ===== Footer Tahun Otomatis =====
document.getElementById("fullDate").textContent=new Date().getFullYear();
});
</script>

</body>
</html>
