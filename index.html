<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>DEXBLOX.ID - Topup Roblox</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      margin:0; padding:0;
      background:#000;
      color:#0ff;
      font-family: Arial, Helvetica, sans-serif;
      overflow-x:hidden;
    }

    /* Background kode hacker bergerak */
    .code-bg {
      position:fixed; top:0; left:0;
      width:100%; height:100%;
      background:#000;
      overflow:hidden;
      z-index:-1;
    }
    .code-line {
      position:absolute;
      top:-100%;
      width:2px;
      height:100%;
      background:linear-gradient(to bottom, rgba(0,255,255,0.8), rgba(0,255,0,0.8), transparent);
      animation: rain 6s linear infinite;
    }
    @keyframes rain {
      0% { top:-100%; opacity:0; }
      10% { opacity:1; }
      100% { top:100%; opacity:0; }
    }

    header {
      text-align:center; padding:20px;
      border-bottom:1px solid rgba(0,255,255,0.3);
      position:relative;
    }
    header h1 {
      font-size:32px; font-weight:900;
      color:#0ff;
      text-shadow:0 0 10px #0ff, 0 0 20px #0f0;
      margin:0;
    }

    .container {
      margin:20px; padding:15px;
      background:rgba(0,50,50,0.5);
      border:1px solid rgba(0,255,255,0.5);
      border-radius:10px;
      box-shadow:0 0 15px rgba(0,255,255,0.4);
    }
    .panel {margin-top:15px; padding-top:10px; border-top:1px solid rgba(0,255,255,0.3);}
    .panel h3 {font-size:18px; margin-bottom:10px; text-align:center; color:#0ff;}
    .form-group {text-align:center;}
    input,select {
      width:80%; margin:10px auto; padding:10px; font-size:15px;
      border-radius:6px; display:block;
      font-family: Arial, Helvetica, sans-serif;
      border:1px solid rgba(0,255,255,0.4);
      background:rgba(0,0,0,0.6); color:#0ff;
    }
    /* Tombol putih transparan neon */
    button {
      background: rgba(255,255,255,0.1);
      color: #fff;
      border: 1px solid #fff;
      cursor: pointer;
      font-weight: bold;
      font-size: 13px;
      padding: 6px 12px;
      border-radius: 6px;
      transition: 0.3s;
      box-shadow: 0 0 8px rgba(255,255,255,0.6);
    }
    button:hover {
      background: rgba(255,255,255,0.3);
      color: #000;
      box-shadow: 0 0 12px #0ff;
    }
    .info-box {
      background:rgba(0,255,255,0.1);
      border:1px solid rgba(0,255,255,0.5);
      border-radius:8px;
      padding:14px;
      margin-bottom:18px;
      text-align:center;
      font-weight:bold;
      line-height:1.6;
    }
    .info-box span {display:block;}
    .info-box .main-price {font-size:16px; color:#0ff; text-shadow:0 0 6px #0f0;}
    .info-box .sub-price {font-size:14px; color:#fff; opacity:0.9;}
    #notifBox {
      margin-top:10px; padding:8px 12px; border-radius:6px;
      font-size:14px; font-weight:bold; text-align:center;
      background:rgba(0,255,255,0.2); border:1px solid #0ff; color:#fff;
      text-shadow:0 0 6px #0ff, 0 0 10px #0f0; box-shadow:0 0 12px #0ff;
    }
    .admin-box {
      margin:20px; padding:15px;
      background:rgba(0,50,50,0.8);
      border:1px solid #0ff;
      border-radius:10px;
      box-shadow:0 0 12px #0f0;
      text-align:center;
    }
    .admin-box h3 {color:#0ff;}
    .admin-box input {width:70%; margin:10px auto;}
  </style>
</head>
<body>
  <div class="code-bg">
    <div class="code-line" style="left:10%; animation-delay:0s;"></div>
    <div class="code-line" style="left:30%; animation-delay:2s;"></div>
    <div class="code-line" style="left:50%; animation-delay:4s;"></div>
    <div class="code-line" style="left:70%; animation-delay:1s;"></div>
    <div class="code-line" style="left:90%; animation-delay:3s;"></div>
  </div>

  <header>
    <h1>DEXBLOX.ID</h1>
  </header>

  <div class="container">
    <div class="info-box">
      <span class="main-price">üí∞ Harga Resmi : Rp110 per Robux</span>
      <span class="sub-price">(100 Robux / Rp11.000)</span>
    </div>

    <!-- Panel Cek Username -->
    <div class="panel form-group">
      <h3>üë§ Cek Username</h3>
      <input type="text" id="username" placeholder="Masukkan username Roblox">
      <button onclick="cekUser()">Cek Username</button>
      <div id="notifBox" style="display:none;"></div>
      <div id="userInfo"></div>
    </div>

    <!-- Panel Custom Robux -->
    <div class="panel form-group">
      <h3>üì¶ Custom Paket Robux</h3>
      <input type="number" id="customRobux" placeholder="Masukkan jumlah Robux">
      <button onclick="hitungHarga()">Hitung Harga</button>
      <p id="paketInfo"></p>
    </div>

    <!-- Panel Gamepass -->
    <div class="panel form-group">
      <h3>üéÆ Gamepass Resmi</h3>
      <input type="text" id="gamepassLink" placeholder="Masukkan link Gamepass Roblox">
      <button onclick="tambahGamepass()">Tambah Gamepass</button>
      <ul id="gamepassList" style="list-style:none; padding:0; text-align:center;"></ul>
    </div>

    <!-- Panel Pembayaran -->
    <div class="panel form-group">
      <h3>üí≥ Pembayaran</h3>
      <select id="payment">
        <option value="gopay">GoPay</option>
        <option value="ovo">OVO</option>
        <option value="dana">DANA</option>
        <option value="qris">QRIS</option>
      </select>
      <button onclick="topup()">Topup Sekarang</button>
    </div>
  </div>

  <!-- Admin Login di bawah -->
  <div class="admin-box">
    <h3>üîë Admin Login</h3>
    <input type="password" id="adminPass" placeholder="Masukkan Password Admin">
    <button onclick="adminLogin()">Login</button>
    <p id="adminResult"></p>
    <div id="adminPanel" style="display:none;">
      <label for="newPrice">Harga/Robux:</label>
      <input type="number" id="newPrice" placeholder="Rp">
      <button onclick="updatePrice()">Update</button>
    </div>
  </div>

<script>
  let base = "https://dexblox.vercel.app/api"; 
  let currentUserId = null;
  let pricePerRobux = 110;

  // Load harga dari localStorage
  window.onload = () => {
    const savedPrice = localStorage.getItem("pricePerRobux");
    if (savedPrice) {
      pricePerRobux = parseInt(savedPrice);
      document.querySelector(".info-box").innerHTML =
        `<span class="main-price">üí∞ Harga Resmi : Rp${pricePerRobux} per Robux</span>
         <span class="sub-price">(100 Robux / Rp${(100*pricePerRobux).toLocaleString()})</span>`;
    }
  };

  async function cekUser() {
    const username = document.getElementById('username').value.trim();
    const notifBox = document.getElementById('notifBox');
    const userInfo = document.getElementById('userInfo');

    if (!username) {
      notifBox.style.display = "block";
      notifBox.innerText = "‚ö†Ô∏è Username belum diisi!";
      userInfo.innerHTML = "";
      return;
    } else {
      notifBox.style.display = "none";
    }

    userInfo.innerHTML = "Loading...";
    try {
      const res = await fetch(`${base}/user?username=${username}`);
      const data = await res.json();
      const userId = data.Id || data.id || data.data?.[0]?.id;
      if (!userId) throw new Error("UserId tidak ditemukan!");
      currentUserId = userId;

      const avatarRes = await fetch(`${base}/avatar?userId=${userId}`);
      const avatarData = await avatarRes.json();
      const avatarUrl = avatarData.imageUrl || avatarData.data?.[0]?.imageUrl;

      userInfo.innerHTML = `
        <p>‚úÖ Username valid: <b>${username}</b> (UserId: ${userId})</p>
        ${avatarUrl ? `<img class="avatar" src="${avatarUrl}" width="120">` : `<p>Avatar tidak ditemukan.</p>`}
      `;
    } catch (err) {
      userInfo.innerHTML = `<p style="color:red;">Error: ${err.message}</p>`;
    }
  }

  function hitungHarga() {
    const robux = parseInt(document.getElementById('customRobux').value);
    if (!robux || robux <= 0) {
      document.getElementById('paketInfo').innerText = "‚ùå Masukkan jumlah Robux yang valid!";
      return;
    }

    const gross = robux * pricePerRobux;
    const setId = Math.round(robux * 1.43);

    document.getElementById('paketInfo').innerText =
      `üì¶ Paket: ${robux} Robux 
       | üí∞ Harga User: Rp${gross.toLocaleString()} 
       | üîë Set ID: ${setId}`;
  }

  function tambahGamepass() {
    const link = document.getElementById('gamepassLink').value.trim();
    if (!link) {
      alert("Isi dulu link Gamepass Roblox!");
      return;
    }
    const list = document.getElementById('gamepassList');
    const li = document.createElement('li');
    li.innerHTML = `<a href="${link}" target="_blank">${link}</a>`;
    list.appendChild(li);
    document.getElementById('gamepassLink').value = "";
  }

  function topup() {
    const username = document.getElementById('username').value.trim();
    const robux = document.getElementById('customRobux').value;
    const payment = document.getElementById('payment').value;
    if (!currentUserId) return alert("Cek username dulu sebelum topup!");
    if (!robux) return alert("Isi jumlah Robux dulu!");

    const gross = robux * pricePerRobux;
    const setId = Math.round(robux * 1.43);

    // Ambil semua link gamepass
    const gamepassItems = document.querySelectorAll('#gamepassList li a');
    let gamepassText = "";
    if (gamepassItems.length > 0) {
      gamepassText = "\nüéÆ Gamepass:\n";
      gamepassItems.forEach((a) => {
        gamepassText += `- ${a.href}\n`;
      });
    }

    const message = `Halo Admin Dexblox, saya ingin topup ${robux} Robux (Rp${gross.toLocaleString()}) untuk username ${username} via ${payment}. (Set ID: ${setId})${gamepassText}`;
    const phone = "6285362187740"; 
    const waUrl = `https://wa.me/${phone}?text=${encodeURIComponent(message)}`;
    window.open(waUrl, "_blank");
  }

  function adminLogin() {
    const pass = document.getElementById('adminPass').value;
    if (pass === "12345") {
      document.getElementById('adminResult').innerText = "‚úÖ Login berhasil. Selamat datang Admin!";
      document.getElementById('adminPanel').style.display = "block";
    } else {
      document.getElementById('adminResult').innerText = "‚ùå Password salah.";
    }
  }

  function updatePrice() {
    const newPrice = parseInt(document.getElementById('newPrice').value);
    if (!newPrice || newPrice <= 0) {
      alert("Isi harga baru per Robux!");
      return;
    }
    pricePerRobux = newPrice;
    localStorage.setItem("pricePerRobux", pricePerRobux);

    document.querySelector(".info-box").innerHTML =
      `<span class="main-price">üí∞ Harga Resmi : Rp${pricePerRobux} per Robux</span>
       <span class="sub-price">(100 Robux / Rp${(100*pricePerRobux).toLocaleString()})</span>`;

    document.getElementById('adminResult').innerText =
      `‚úÖ Harga per Robux diupdate jadi Rp${pricePerRobux.toLocaleString()}`;

    hitungHarga();
  }
</script>
</body>
</html>
