<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>DEXBLOX.ID - Topup Roblox</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {margin:0; padding:0; background:#000; color:#0ff; font-family:Arial, sans-serif;}
    header{text-align:center; padding:20px; border-bottom:1px solid rgba(0,255,255,0.3);}
    .logo{display:block; margin:0 auto 10px; width:120px;}
    header h1{font-size:32px; font-weight:900; color:#0ff;}
    .subtitle{font-size:18px; font-weight:bold; color:#0f0;}
    .container{margin:20px; padding:15px; background:rgba(0,50,50,0.5); border:1px solid rgba(0,255,255,0.5); border-radius:10px;}
    .panel{margin-top:15px; padding-top:10px; border-top:1px solid rgba(0,255,255,0.3);}
    .panel h3{text-align:center; color:#0ff;}
    .form-group{text-align:center;}
    input{width:80%; margin:10px auto; padding:10px; font-size:15px; border-radius:6px;
      border:1px solid rgba(0,255,255,0.4); background:rgba(0,0,0,0.6); color:#0ff;}
    button{background:rgba(255,255,255,0.1); color:#fff; border:1px solid #fff; cursor:pointer; font-weight:bold;
      font-size:13px; padding:6px 12px; border-radius:6px;}
    .info-box{background:rgba(0,255,255,0.1); border:1px solid rgba(0,255,255,0.5); border-radius:8px; padding:14px; text-align:center;}
    #alertBox{margin-top:10px; padding:8px 12px; border-radius:6px; font-size:14px; font-weight:bold; text-align:center;
      background:rgba(0,255,255,0.2); border:1px solid #0ff; color:#fff; display:none;}
    #gamepassNotif{margin-top:10px; padding:8px; border-radius:6px; font-size:14px; font-weight:bold; text-align:center;
      background:rgba(0,255,255,0.2); border:1px solid #0ff; color:#fff; display:none;}
    .avatar{border:2px solid #0ff; border-radius:50%; box-shadow:0 0 15px #0f0;}
    .floating-btn{position:fixed; top:20px; right:20px; background:#0ff; color:#000; border:none; border-radius:50%; width:45px; height:45px;}
    .admin-panel{position:fixed; top:70px; right:20px; background:rgba(0,50,50,0.9); border:1px solid #0ff; border-radius:8px; padding:10px;
      width:200px; display:none;}
    #topupNotif{position:fixed; bottom:20px; left:50%; transform:translateX(-50%); background:rgba(0,255,255,0.2); border:1px solid #0ff;
      color:#fff; padding:12px 20px; border-radius:8px; font-size:15px; font-weight:bold; text-align:center; display:none;}
  </style>
</head>
<body>
  <header>
    <img src="/dexblox.png" alt="Logo Dexblox" class="logo">
    <h1>DEXBLOX.ID</h1>
    <h2 class="subtitle">Topup Gamepass 5‚Äì7 Hari Termurah di Dunia</h2>
  </header>

  <div class="container">
    <div id="infoBox" class="info-box">
      <span class="main-price">üí∞ Harga Resmi : Rp110 per Robux</span>
      <span class="sub-price">(100 Robux / Rp11.000)</span>
    </div>

    <!-- Panel Username -->
    <div class="panel form-group">
      <h3>üë§ Cek Username</h3>
      <input type="text" id="username" placeholder="Masukkan username Roblox">
      <button onclick="cekUser()">Cek Username</button>
      <div id="alertBox"></div>
      <div id="userInfo"></div>
    </div>

    <!-- Panel Custom Robux -->
    <div class="panel form-group">
      <h3>üì¶ Custom Paket Robux</h3>
      <input type="number" id="customRobux" placeholder="Masukkan jumlah Robux" oninput="hitungHarga(); updateRingkasan();">
      <p id="paketInfo"></p>
    </div>

    <!-- Panel Gamepass -->
    <div class="panel form-group">
      <h3>üéÆ Gamepass Resmi</h3>
      <input type="text" id="gamepassLink" placeholder="Masukkan link Gamepass Roblox" oninput="tambahGamepass(); updateRingkasan();">
      <div id="gamepassNotif"></div>
      <ul id="gamepassList" style="list-style:none; padding:0; text-align:center;"></ul>
    </div>

    <!-- Panel Ringkasan -->
    <div class="panel form-group">
      <h3>üìÑ Ringkasan Pesanan</h3>
      <div id="ringkasanBox" style="font-size:14px; line-height:1.6; background:rgba(0,255,255,0.05); padding:10px; border-radius:8px;">
        Username: <span id="ringkasanUsername">-</span><br>
        Jumlah Robux: <span id="ringkasanJumlah">-</span><br>
        Total: <span id="ringkasanTotal">-</span>
      </div>
    </div>

    <!-- Panel QRIS -->
    <div class="panel form-group">
      <h3>üí≥ Pembayaran QRIS</h3>
      <div id="qrisBox" style="margin-top:10px; display:none;">
        <img src="/qris.png" alt="QRIS Dexblox"
             style="width:220px; border:2px solid #0ff; border-radius:8px; display:block; margin:0 auto;">
        <p style="color:#0ff; font-weight:bold; margin-top:8px;">Scan QRIS untuk pembayaran</p>
        <input type="file" id="buktiFile" accept="image/*" style="margin-top:10px;">
        <button onclick="konfirmasiPembayaran()">Konfirmasi Pembayaran</button>
      </div>
      <button onclick="topup()">Topup Sekarang</button>
    </div>
  </div>

  <!-- Tombol Admin -->
  <button class="floating-btn" onclick="toggleAdmin()">üîë</button>

  <!-- Panel Admin -->
  <div id="adminPanelBox" class="admin-panel">
    <h3 style="margin:0; font-size:14px; color:#0ff;">Admin Login</h3>
    <input type="password" id="adminPass" placeholder="Kode admin">
    <button onclick="adminLogin()">Login</button>
    <p id="adminResult"></p>
    <div id="adminPanel" style="display:none; margin-top:8px;">
      <label for="newPrice">Harga/Robux:</label>
      <input type="number" id="newPrice" placeholder="Rp">
      <button onclick="updatePrice()">Update</button>
    </div>
  </div>

  <!-- Notifikasi -->
  <div id="topupNotif">üöÄ Permintaan Topup dikirim ke Admin Dexblox!</div>

<script>
  let base = "https://dexblox.vercel.app/api";
  let pricePerRobux = 110;
  let currentUserId = null;

  async function cekUser() {
    const username = document.getElementById('username').value.trim();
    const alertBox = document.getElementById('alertBox');
    const userInfo = document.getElementById('userInfo');

    if (!username) {
      alertBox.innerText = "‚ö†Ô∏è Username belum diisi!";
      alertBox.style.display = "block";
      setTimeout(() => { alertBox.style.display = "none"; }, 4000);
      userInfo.innerHTML = "";
      return;
    }

    userInfo.innerHTML = "Loading...";
    try {
      const res = await fetch(`${base}/user?username=${username}`);
      const data = await res.json();
      const userId = data.Id || data.id || data.data?.[0]?.id;
      if (!userId) throw new Error("UserId tidak ditemukan!");
      currentUserId = userId;

      const avatarRes = await fetch(`${base}/avatar?userId=${userId}`);
      const avatarData = await avatarRes.json();
      const avatarUrl = avatarData.imageUrl || avatarData.data?.[0]?.imageUrl;

      userInfo.innerHTML = `
        <p>Username ditemukan: <b>${username}</b></p>
        ${avatarUrl ? `<img class="avatar" src="${avatarUrl}" width="120">` : `<p>Avatar tidak ditemukan.</p>`}
      `;
      updateRingkasan();
    } catch (err) {
      userInfo.innerHTML = `<p style="color:red;">Error: ${err.message}</p>`;
    }
  }

  function hitungHarga() {
    const robux = parseInt(document.getElementById('customRobux').value);
    const alertBox = document.getElementById('alertBox');
    if (!robux || robux <= 0) {
      alertBox.innerText = "‚ö†Ô∏è Masukkan jumlah Robux yang valid!";
      alertBox.style.display = "block";
      setTimeout(() => { alertBox.style.display = "none"; }, 4000);
      return;
    }
    const gross = robux * pricePerRobux;
    const setId = Math.round(robux * 1.43);
    document.getElementById('paketInfo').innerText =
      `üì¶ Paket: ${robux} Robux | üí∞ Rp${gross.toLocaleString()} | üîë Set ID: ${setId}`;
  }

  function tambahGamepass() {
    const link = document.getElementById('gamepassLink').value.trim();
    const list = document.getElementById('gamepassList');
    const notif = document.getElementById('gamepassNotif');

    if (!link) {
      list.innerHTML = "";
      notif.style.display = "none";
      return;
    }
    if (link.includes("roblox.com")) {
      notif.style.display = "block";
      notif.style.color = "lime";
      notif.innerText = "‚úÖ Link Gamepass valid dari Roblox.";
      list.innerHTML = `<li><a href="${link}" target="_blank">${link}</a></li>`;
    } else {
      notif.style.display = "block";
      notif.style.color = "red";
      notif.innerText = "‚ùå Link harus dari Roblox!";
      list.innerHTML = "";
    }
  }

  function updateRingkasan() {
    const robux = parseInt(document.getElementById('customRobux').value) || 0;
    const username = document.getElementById('username').value.trim() || "-";
    const gross = robux * pricePerRobux;
    document.getElementById('ringkasanUsername').innerText = username;
    document.getElementById('ringkasanJumlah').innerText = robux ? `${robux} Robux` : "-";
    document.getElementById('ringkasanTotal').innerText = robux ? `Rp ${gross.toLocaleString()}` : "-";
  }

  function topup() {
    const username = document.getElementById('username').value.trim();
    const robux = document.getElementById('customRobux').value;
    const alertBox = document.getElementById('alertBox');

    if (!currentUserId) {
      alertBox.innerText = "‚ö†Ô∏è Cek username dulu sebelum topup!";
      alertBox.style.display = "block";
      setTimeout(() => { alertBox.style.display = "none"; }, 4000);
      return;
    }
    if (!robux) {
      alertBox.innerText = "‚ö†Ô∏è Isi jumlah Robux dulu!";
      alertBox.style.display = "block";
      setTimeout(() => { alertBox.style.display = "none"; }, 4000);
      return;
    }
    document.getElementById('qrisBox').style.display = "block";
  }

  function konfirmasiPembayaran() {
    const username = document.getElementById('username').value.trim();
    const robux = document.getElementById('customRobux').value;
    const gross = robux * pricePerRobux;
    const setId = Math.round(robux * 1.43);

    const gamepassItems = document.querySelectorAll('#gamepassList li a');
    let gamepassText = "";
    if (gamepassItems.length > 0) {
      gamepassText = "\nüéÆ Gamepass:\n";
      gamepassItems.forEach((a) => { gamepassText += `- ${a.href}\n`; });
    }

    const message = `Halo Admin Dexblox, topup ${robux} Robux (Rp${gross.toLocaleString()}) untuk ${username} via QRIS sukses. (Set ID: ${setId})${gamepassText}`;
    const phone = "6285362187740"; 
    const waUrl = `https://wa.me/${phone}?text=${encodeURIComponent(message)}`;
    window.open(waUrl, "_blank");

    const notif = document.getElementById('topupNotif');
    notif.style.display = "block";
    notif.innerText = "üöÄ Pembayaran sukses, permintaan Topup dikirim ke Admin Dexblox!";
    setTimeout(() => { notif.style.display = "none"; }, 4000);
  }

  function toggleAdmin() {
    const panel = document.getElementById('adminPanelBox');
    panel.style.display = (panel.style.display === "block") ? "none" : "block";
  }

  function adminLogin() {
    const pass = document.getElementById('adminPass').value;
    if (pass === "300403") {
      document.getElementById('adminResult').innerText = "‚úÖ Login berhasil!";
      document.getElementById('adminPanel').style.display = "block";
    } else {
      document.getElementById('adminResult').innerText = "‚ùå Kode salah.";
    }
  }

  function updatePrice() {
    const newPrice = parseInt(document.getElementById('newPrice').value);
    const alertBox = document.getElementById('alertBox');

    if (!newPrice || newPrice <= 0) {
      alertBox.innerText = "‚ö†Ô∏è Isi harga baru per Robux!";
      alertBox.style.display = "block";
      setTimeout(() => { alertBox.style.display = "none"; }, 4000);
      return;
    }

    pricePerRobux = newPrice;
    localStorage.setItem("pricePerRobux", pricePerRobux);

    document.getElementById("infoBox").innerHTML =
      `<span class="main-price">üí∞ Harga Resmi : Rp${pricePerRobux} per Robux</span>
       <span class="sub-price">(100 Robux / Rp${(100*pricePerRobux).toLocaleString()})</span>`;

    document.getElementById('adminResult').innerText =
      `‚úÖ Harga per Robux diupdate jadi Rp${pricePerRobux.toLocaleString()}`;

    hitungHarga(); 
    updateRingkasan();
  }
</script>
</body>
</html>
