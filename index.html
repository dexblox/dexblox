<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DEXBLOX.ID - Topup Robux</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: linear-gradient(-45deg,#000033,#003366,#00aa88,#000);
      background-size:400% 400%;
      animation:gradientMove 15s ease infinite;
      font-family:monospace;
    }
    @keyframes gradientMove {
      0%{background-position:0% 50%}
      50%{background-position:100% 50%}
      100%{background-position:0% 50%}
    }
    .paket-card {transition:.3s;cursor:pointer;background:#2d3748}
    .paket-card:hover {transform:scale(1.03)}
    .glow-title {color:#0ff;text-shadow:0 0 10px #0ff,0 0 20px #0ff;}
    .logo-glitch {
      filter:drop-shadow(0 0 10px #0ff) drop-shadow(0 0 20px #0ff);
      animation: glitch 1.2s infinite, spin 4s linear infinite;
      transform-style: preserve-3d;
      perspective: 1000px;
      transition: transform 0.3s ease;
    }
    @keyframes glitch {
      0%{transform:translate(0) rotateY(0deg)}
      20%{transform:translate(-1px,1px) rotateY(72deg)}
      40%{transform:translate(-1px,-1px) rotateY(144deg)}
      60%{transform:translate(1px,1px) rotateY(216deg)}
      80%{transform:translate(1px,-1px) rotateY(288deg)}
      100%{transform:translate(0) rotateY(360deg)}
    }
    @keyframes spin {0%{transform:rotateY(0deg)}100%{transform:rotateY(360deg)}}
    #notifPanel {position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);display:none;align-items:center;justify-content:center;z-index:50}
    #notifContent {background:#1a202c;border:2px solid #0ff;box-shadow:0 0 20px #0ff,0 0 40px #0ff;padding:20px;border-radius:12px;text-align:center;max-width:320px}
    .glow-price {text-shadow:0 0 10px #0f0,0 0 20px #0f0}
    #avatarPreview {box-shadow:0 0 15px #0ff,0 0 30px #0ff}
    #particleCanvas {position:fixed;top:0;left:0;width:100%;height:100%;z-index:0;pointer-events:none}
    .glow-footer {text-shadow:0 0 6px rgba(255,255,255,.6),0 0 12px rgba(255,255,255,.4)}
  </style>
</head>
<body class="flex flex-col items-center min-h-screen relative">

<canvas id="particleCanvas"></canvas>

<header class="z-10 text-center mt-6 mb-6">
  <img src="/dexblox.png" alt="Logo DEXBLOX" class="logo-glitch mx-auto mb-4 w-40 h-40">
  <h1 class="text-5xl font-extrabold glow-title">DEXBLOX.ID</h1>
  <p class="text-white mt-2">Topup Robux Termurah Di Indonesia</p>
</header>

<!-- User Panel -->
<div id="userSection" class="z-10 w-[90%] max-w-md bg-gray-900 bg-opacity-70 p-6 rounded-xl shadow-lg text-center">
   <h2 class="text-2xl font-bold text-white mb-4">Topup Gamepass 5hari</h2>
   <h3 class="text-lg font-bold text-white mb-2">Harga Hari Ini</h3>
   <p class="text-white mb-4">
     Rp <span id="hargaHariIni" class="text-2xl font-extrabold text-green-400 glow-price">...</span> / 100 Robux
   </p>
   <!-- Form Topup (isi sesuai versi kamu sebelumnya) -->
</div>

<!-- Admin Panel -->
<div id="adminTools" class="z-10 w-[90%] max-w-md bg-gray-900 bg-opacity-70 p-6 rounded-xl shadow-lg text-center mt-6">
  <h2 class="text-green-400 font-bold text-lg mb-4">Admin Panel</h2>
  <input type="password" id="adminPassword" class="w-full p-2 rounded bg-gray-800 text-white text-center mb-4" placeholder="••••••••">
  <label class="block mb-2 text-white">Update Harga per 100 Robux</label>
  <input type="number" id="baseHarga" class="w-full p-2 rounded bg-gray-800 text-white text-center mb-4" placeholder="Masukkan harga baru">
  <button id="btnUpdateHarga" class="bg-cyan-500 hover:bg-cyan-600 text-white px-4 py-2 rounded">Simpan Harga</button>
</div>

<!-- Footer -->
<footer class="text-center mt-12 mb-4 text-sm text-white glow-footer w-full">
  © <span id="fullDate"></span> DEXBLOX.ID — Semua hak cipta dilindungi
</footer>

<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

  const supabaseUrl = "https://<project-ref>.supabase.co";
  const supabaseKey = "sb_publishable_xxxxx"; 
  const supabase = createClient(supabaseUrl, supabaseKey);

  // Ambil harga awal dari Supabase
  async function loadHarga(){
    const { data, error } = await supabase.from("harga").select("*").eq("id",1).single();
    if(error){ console.error(error); return; }
    document.getElementById("hargaHariIni").textContent = data.harga_per_100.toLocaleString("id-ID");
  }
  loadHarga();

  // Update harga (Admin)
  async function updateHarga(){
    const baseHarga = parseInt(document.getElementById("baseHarga").value);
    if(isNaN(baseHarga) || baseHarga <= 0){ alert("Harga tidak valid!"); return; }
    const { data, error } = await supabase
      .from("harga")
      .update({ harga_per_100: baseHarga, updated_at: new Date() })
      .eq("id",1);
    if(error){ alert("Update gagal: " + error.message); }
    else { alert("Harga berhasil diperbarui!"); }
  }
  document.getElementById("btnUpdateHarga").addEventListener("click", updateHarga);

  // Listener realtime untuk user
  supabase
    .channel("harga-changes")
    .on("postgres_changes",{ event:"UPDATE", schema:"public", table:"harga" },(payload)=>{
      document.getElementById("hargaHariIni").textContent = payload.new.harga_per_100.toLocaleString("id-ID");
    })
    .subscribe();

  // Footer tanggal otomatis
  const today = new Date();
  const options = { day: 'numeric', month: 'long', year: 'numeric' };
  document.getElementById("fullDate").textContent = today.toLocaleDateString("id-ID", options);
</script>

</body>
</html>
