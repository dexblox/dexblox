<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DEXBLOX.ID - Topup Robux</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: linear-gradient(-45deg,#000033,#003366,#000066,#000);
      background-size:400% 400%;
      animation:gradientMove 15s ease infinite;
      font-family:monospace;
    }
    @keyframes gradientMove {
      0%{background-position:0% 50%}
      50%{background-position:100% 50%}
      100%{background-position:0% 50%}
    }
    .paket-card {transition:.3s;cursor:pointer;background:#2d3748}
    .paket-card:hover {transform:scale(1.03)}
    .glow-title {color:#0ff;text-shadow:0 0 10px #0ff,0 0 20px #0ff;}
    #notifPanel {position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);display:none;align-items:center;justify-content:center;z-index:50}
    #notifContent {background:#1a202c;border:2px solid #0ff;box-shadow:0 0 20px #0ff,0 0 40px #0ff;padding:20px;border-radius:12px;text-align:center;max-width:320px}
    .glow-footer {text-shadow:0 0 6px rgba(255,255,255,.6),0 0 12px rgba(255,255,255,.4)}
  </style>
</head>
<body class="flex flex-col items-center min-h-screen relative">

<header class="z-10 text-center mt-6 mb-6">
  <img src="/dexblox.png" alt="Logo DEXBLOX" class="mx-auto mb-4 w-40 h-40">
  <h1 class="text-5xl font-extrabold glow-title">DEXBLOX.ID</h1>
  <p class="text-white mt-2">Topup Robux Termurah Di Indonesia</p>
</header>

<!-- Form Topup -->
<div class="z-10 w-[90%] max-w-md bg-gray-900 bg-opacity-70 p-6 rounded-xl shadow-lg text-center">
   <h2 class="text-2xl font-bold text-white mb-4">Topup Gamepass 5hari</h2>
  <form id="topupForm" class="space-y-6">
    <!-- Username -->
    <div>
      <label class="block mb-1 text-white">Username Roblox</label>
      <input type="text" id="username" class="w-full p-2 rounded bg-gray-700 text-white text-center" placeholder="Masukkan Username Roblox">
      <p id="notifUsername" class="text-xs mt-1"></p>
    </div>

    <!-- Paket -->
    <section>
      <h3 class="text-lg font-bold text-white mb-2">Harga Hari Ini</h3>
      <p class="text-white mb-4">
        Rp <span id="hargaHariIni" class="text-2xl font-extrabold text-green-400">...</span> / 100 Robux
      </p>
      <div class="grid grid-cols-2 gap-4">
        <div class="paket-card p-4 rounded-lg text-white font-bold" data-value="100">100 Robux</div>
        <div class="paket-card p-4 rounded-lg text-white font-bold" data-value="200">200 Robux</div>
        <div class="paket-card p-4 rounded-lg text-white font-bold" data-value="500">500 Robux</div>
        <div class="paket-card p-4 rounded-lg text-white font-bold" data-value="1000">1000 Robux</div>
      </div>
      <p id="notifPaket" class="text-xs mt-1"></p>
    </section>

    <!-- Custom Paket -->
    <section>
      <h3 class="text-lg font-bold text-white mb-2">Custom Paket Robux</h3>
      <input type="number" id="customRobux" class="p-2 rounded bg-gray-700 text-white text-center w-48" placeholder="Jumlah Robux">
      <p id="notifCustom" class="text-xs mt-1"></p>
    </section>

    <p id="paketInfo" class="text-green-400 font-bold mt-2"></p>
    <input type="hidden" id="robux" name="robux">

    <!-- Promo -->
    <div>
      <label class="block mb-1 text-white">Kode Promo</label>
      <div class="flex space-x-2">
        <input type="text" id="promoInput" class="flex-1 p-2 rounded bg-gray-700 text-white text-center" placeholder="Masukkan kode promo">
        <button type="button" id="btnPromo" class="bg-yellow-400 hover:bg-yellow-500 text-black font-bold px-4 rounded">Cek</button>
      </div>
      <p id="notifPromo" class="text-xs mt-1"></p>
    </div>

    <button type="submit" class="w-full bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-2 px-4 rounded shadow-lg">Topup</button>
  </form>
</div>

<div id="notifPanel"><div id="notifContent"></div></div>

<!-- Admin Panel -->
<div id="adminModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
  <div class="bg-gray-900 bg-opacity-70 p-6 rounded-lg shadow-lg text-center max-w-sm border border-green-400">
    <h2 class="text-green-400 font-bold text-lg mb-4">Admin Panel</h2>
    <input type="password" id="adminPassword" class="w-full p-2 rounded bg-gray-800 text-white text-center mb-4" placeholder="••••••••">
    <div id="adminTools" class="hidden">
      <h3 class="text-cyan-400 font-bold mt-6 mb-2">Kirim Bukti ke User</h3>
      <input type="text" id="adminUser" placeholder="Username Roblox" class="w-full p-2 rounded bg-gray-800 text-white mb-2">
      <input type="text" id="adminRobux" placeholder="Jumlah Robux" class="w-full p-2 rounded bg-gray-800 text-white mb-2">
      <select id="adminMetode" class="w-full p-2 rounded bg-gray-800 text-white mb-2">
        <option value="qris">QRIS</option>
        <option value="transfer">Transfer Bank</option>
        <option value="dana">Dana</option>
      </select>
      <button id="btnKirimBukti" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded">Kirim Bukti</button>
    </div>
    <button id="btnAdminLogin" class="w-full bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-2 px-4 rounded mt-4">Login Admin</button>
    <p id="notifAdmin" class="text-xs mt-2"></p>
  </div>
</div>

<!-- Footer -->
<footer class="text-center mt-12 mb-4 text-sm text-white glow-footer w-full">
  © <span id="fullDate"></span> DEXBLOX.ID — Semua hak cipta dilindungi
</footer>

<script>
  let hargaPer100 = 12000; // fallback default
  let promoActive = false;
  let userProfileUrl = "";

  // Ambil harga dari API ENV
  async function fetchHarga(){
    try {
      const res = await fetch("/api/harga");
      const data = await res.json();
      if(res.ok && data.hargaPer100){
        hargaPer100 = data.hargaPer100;
        document.getElementById("hargaHariIni").textContent = hargaPer100.toLocaleString("id-ID");
      }
    } catch(err){
      document.getElementById("hargaHariIni").textContent = hargaPer100.toLocaleString("id-ID");
    }
  }
  fetchHarga();

  // Hitung harga sesuai Robux
  function updateHargaInfo(robux){
    if(!robux || robux <= 0){
      document.getElementById("paketInfo").textContent = "";
      return;
    }
    let harga = (robux/100) * hargaPer100;
    if(promoActive){ harga = Math.round(harga * 0.96); } // diskon 4%
    const gamepassId = Math.round((robux/100) * 143);
    document.getElementById("paketInfo").textContent =
      `${robux} Robux = Rp${harga.toLocaleString("id-ID")} (Gamepass : ${gamepassId})`;
    document.getElementById("robux").value =
      `${robux} Robux - Rp${harga.toLocaleString("id-ID")} (Gamepass : ${gamepassId})`;
  }

  // Pilih paket
  document.querySelectorAll(".paket-card").forEach(card=>{
    card.addEventListener("click",()=>{
      const robux = parseInt(card.dataset.value);
      updateHargaInfo(robux);
      document.getElementById("notifPaket").textContent = "Paket dipilih";
      document.getElementById("notifPaket").style.color = "lime";
    });
  });

  // Custom paket
  document.getElementById("customRobux").addEventListener("input",(e)=>{
    const robux = parseInt(e.target.value);
    updateHargaInfo(robux);
    document.getElementById("notifCustom").textContent = "Custom paket aktif";
    document.getElementById("notifCustom").style.color = "lime";
  });

  // Promo
  document.getElementById("btnPromo").addEventListener("click",()=>{
    const kode = document.getElementById("promoInput").value.trim();
    if(kode.toLowerCase() === "dexblox"){
      promoActive = true;
      document.getElementById("notifPromo").textContent = "Promo aktif! Diskon 4%";
      document.getElementById("notifPromo").style.color = "lime";
      const robux = parseInt(document.getElementById("customRobux").value) || parseInt(document.getElementById("robux").value);
      updateHargaInfo(robux);
    } else {
      promoActive = false;
      document.getElementById("notifPromo").textContent = "Kode promo tidak valid";
      document.getElementById("notifPromo").style.color = "red";
    }
  });

  // Submit form → konfirmasi WA
  document.getElementById("topupForm").addEventListener("submit",(e)=>{
    e.preventDefault();
    const username = document.getElementById("username").value.trim();
    const robux = document.getElementById("robux").value;
    if(!username || !robux){
      document.getElementById("notifUsername").textContent = "Isi username & paket!";
      document.getElementById("notifUsername").style.color = "red";
      return;
    }
    const message = `[DEXBLOX.ID] Topup Gamepass\n\nUsername: ${username}\nPaket: ${robux}\nProfile: ${userProfileUrl}\nPromo: ${promoActive?"Ya":"Tidak"}`;
    const waLink = `https://wa.me/6285362187740?text=${encodeURIComponent(message)}`;
    document.getElementById("notifContent").innerHTML = `
      <p class="text-white mb-4">Konfirmasi Topup:<br>${message.replace(/\n/g,"<br>")}</p>
      <button onclick="window.open('${waLink}','_blank')" class="bg-green-500 text-white px-4 py-2 rounded">Ya</button>
      <button onclick="document.getElementById('notifPanel').style.display='none'" class="bg-red-500 text-white px-4 py-2 rounded ml-2">Tidak</button>
    `;
    document.getElementById("notifPanel").style.display = "flex";
  });

  // Admin login
  document.getElementById("btnAdminLogin").addEventListener("click",()=>{
    const pass = document.getElementById("adminPassword").value.trim();
    if(pass === "dexbloxadmin"){ // ganti sesuai password admin
      document.getElementById("adminTools").classList.remove("hidden");
      document.getElementById("notifAdmin").textContent = "Login berhasil";
      document.getElementById("notifAdmin").style.color = "lime";
    } else {
      document.getElementById("notifAdmin").textContent = "Password salah";
      document.getElementById("notifAdmin").style.color = "red";
    }
  });

  // Admin kirim bukti
  document.getElementById("btnKirimBukti").addEventListener("click",()=>{
    const user = document.getElementById("adminUser").value.trim();
    const robux = document.getElementById("adminRobux").value.trim();
    const metode = document.getElementById("adminMetode").value;
    if(!user || !robux || !metode){
      document.getElementById("notifAdmin").textContent = "Lengkapi data bukti!";
      document.getElementById("notifAdmin").style.color = "red";
      return;
    }
    const buktiMsg = `[DEXBLOX.ID] Bukti Topup\n\nUsername: ${user}\nJumlah: ${robux} Robux\nMetode: ${metode}`;
    const waLink = `https://wa.me/${user}?text=${encodeURIComponent(buktiMsg)}`;
    window.open(waLink,"_blank");
  });

  // Set tanggal otomatis di footer
  const today = new Date();
  const options = { day: 'numeric', month: 'long', year: 'numeric' };
  document.getElementById("fullDate").textContent = today.toLocaleDateString("id-ID", options);
</script>

</body>
</html>
