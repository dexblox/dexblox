<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Beli Robux - DEXBLOX.ID</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {margin:0;font-family:'Poppins',sans-serif;background:#fff;color:#000;}
    header {background:rgba(0,0,0,0.8);padding:15px;text-align:center;border-bottom:2px solid #000;}
    header h1 {margin:0;font-size:22px;font-weight:600;color:#fff;}
    .container {max-width:95%;margin:20px auto;padding:15px;}
    .panel {margin-bottom:15px;padding:12px;border-radius:10px;background:transparent;border:1px solid #000;}
    .panel h3 {margin:0 0 10px;color:#000;font-size:15px;text-align:center;font-weight:600;}
    .admin-panel h3 {color:#fff;}
    input,button {width:90%;max-width:260px;padding:8px;font-size:13px;border-radius:8px;margin:6px auto;
      display:block;border:1px solid #000;background:transparent;color:#000;font-weight:600;}
    button:hover {transform:scale(1.05);box-shadow:0 0 12px #000;background:rgba(0,0,0,0.1);}
    .info {margin-top:6px;font-size:12px;color:#000;font-weight:bold;text-align:center;}
    .quick-prices {display:grid;grid-template-columns:1fr 1fr;gap:10px;}
    .deskripsi {font-size:12px;line-height:1.5;text-align:center;color:#000;}
    .garansi {margin-top:10px;font-size:12px;color:#000;text-align:center;font-weight:600;}
    button.submit {background:transparent;border:2px solid #000;color:#000;}
    button.submit:hover {background:rgba(0,0,0,0.2);box-shadow:0 0 12px #000;}
    img.qris {width:100%;border:1px solid #000;border-radius:8px;}
    #topupNotif,#notifError {margin-top:8px;padding:10px;border-radius:10px;font-size:13px;font-weight:600;text-align:center;
      background:linear-gradient(to right,#000,#333);border:2px solid #000;color:#fff;display:none;}
    #notifConfirm {margin-top:8px;padding:12px;border-radius:10px;font-size:13px;font-weight:600;text-align:center;
      background:#fff;border:2px solid #000;color:#000;display:none;}
    .floating-btn {position:fixed;top:15px;right:15px;background:transparent;color:#000;border:1px solid #000;
      border-radius:50%;width:40px;height:40px;font-size:18px;z-index:3;}
    .admin-panel {position:fixed;top:70px;right:15px;background:transparent;border:1px solid #000;
      border-radius:10px;padding:10px;width:200px;display:none;z-index:3;font-size:12px;color:#000;}
    #particles {position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:1;}
    footer {background:rgba(0,0,0,0.8);color:#fff;text-align:center;padding:12px;font-size:12px;border-top:2px solid #000;}
  </style>
</head>
<body>
  <canvas id="particles"></canvas>
  <header><h1>Beli Robux - DEXBLOX.ID</h1></header>

  <div class="container">
    <div class="panel">
      <h3>üë§ Username Roblox</h3>
      <input type="text" id="username" placeholder="Masukkan Username Roblox">
      <button onclick="cekUsername()">üîç Cek Username</button>
      <div id="userInfo" style="margin-top:6px;text-align:center;font-size:12px;color:#000;"></div>
    </div>

    <div class="panel">
      <h3>‚ö° Pilihan Cepat Paket Robux</h3>
      <div class="quick-prices">
        <button onclick="pilihPaket(100,'143')">100 RBX</button>
        <button onclick="pilihPaket(300,'429')">300 RBX</button>
        <button onclick="pilihPaket(500,'715')">500 RBX</button>
        <button onclick="pilihPaket(1000,'1430')">1000 RBX</button>
        <button onclick="pilihPaket(2000,'2860')">2000 RBX</button>
        <button onclick="pilihPaket(5000,'7150')">5000 RBX</button>
        <button onclick="pilihPaket(10000,'14300')">10.000 RBX</button>
        <button onclick="pilihPaket(20000,'28600')">20.000 RBX</button>
        <button onclick="pilihPaket(50000,'71500')">50.000 RBX</button>
      </div>
    </div>

    <div class="panel">
      <h3>üí∞ Jumlah Robux</h3>
      <input type="number" id="jumlahRobux" oninput="hitungManual()">
      <p class="info">Harga: Rp<span id="hargaPer100">11.000</span> / 100 RBX</p>
      <p class="info" id="gamepassInfo">Gamepass: -</p>
      <input type="text" id="totalRp" readonly>
    </div>

    <div class="panel">
      <h3>üìÑ Deskripsi Produk</h3>
      <div class="deskripsi">Top up Robux terpercaya dan termurah. Garansi pembelian 100% aman.</div>
    </div>

    <div class="panel">
      <h3>üí≥ Pembayaran QRIS</h3>
      <img src="/qris.png" alt="QRIS Dexblox" class="qris">
    </div>

    <div class="panel">
      <h3>üöÄ Konfirmasi</h3>
      <button class="submit" onclick="konfirmasiWA()">Lanjutkan Pembelian</button>
      <div id="topupNotif">‚úÖ Topup kamu sedang diproses!</div>
      <div id="notifError">üö® Lengkapi Username dan Jumlah Robux!</div>
      <div id="notifConfirm">
        ‚ö†Ô∏è Apakah Username <span id="confirmUser"></span> dan Jumlah Robux <span id="confirmRobux"></span> sudah benar?
        <br><br>
        <button onclick="lanjutkanWA()">‚úÖ Ya, lanjutkan</button>
        <button onclick="batalConfirm()">‚ùå Batal</button>
      </div>
      <div class="garansi">‚úÖ Garansi 100% Robux Masuk dan Aman</div>
    </div>
  </div>

  <button class="floating-btn" onclick="toggleAdmin()">üîë</button>
  <div id="adminPanelBox" class="admin-panel">
    <h3 style="margin:0; font-size:13px;">Admin Login</h3>
    <input type="password" id="adminPass" placeholder="Kode admin">
    <button onclick="adminLogin()">Login</button>
    <p id="adminResult"></p>
    <div id="adminPanel" style="display:none;margin-top:6px;">
      <label for="newPrice">Harga/100 Robux:</label>
      <input type="number" id="newPrice" placeholder="11000">
      <button onclick="updatePrice()">Update</button>
    </div>
  </div>

<script>
let lastUserProfileUrl = "";
let lastUserName = "";

window.onload = () => {
  const savedPrice = localStorage.getItem("hargaPer100");
  if (savedPrice) {
    document.getElementById('hargaPer100').innerText = parseInt(savedPrice).toLocaleString();
  }
};

// ‚ö° Pilih Paket
function pilihPaket(robux, gamepassId) {
  const hargaPer100 = parseInt(document.getElementById('hargaPer100').innerText.replace(/\./g,''));
  const harga = (robux / 100) * hargaPer100;
  document.getElementById('jumlahRobux').value = robux;
  document.getElementById('totalRp').value = `Rp${harga.toLocaleString()}`;
  document.getElementById('gamepassInfo').innerText = `Gamepass: ${gamepassId}`;
}

// üí∞ Hitung Manual
function hitungManual() {
  const robux = parseInt(document.getElementById('jumlahRobux').value);
  if (!robux) {
    document.getElementById('totalRp').value = "";
    document.getElementById('gamepassInfo').innerText = "Gamepass: -";
    return;
  }
  const hargaPer100 = parseInt(document.getElementById('hargaPer100').innerText.replace(/\./g,''));
  const harga = (robux / 100) * hargaPer100;
  document.getElementById('totalRp').value = `Rp${harga.toLocaleString()}`;
  document.getElementById('gamepassInfo').innerText = `Gamepass: ${robux}`;
}

// üë§ Cek Username Roblox dengan fallback avatar
async function cekUsername() {
  const username = document.getElementById("username").value.trim();
  const userInfoDiv = document.getElementById("userInfo");

  if (!username) {
    userInfoDiv.innerHTML = "üö® Masukkan username dulu!";
    return;
  }

  try {
    const resUser = await fetch("/api/user", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username })
    });
    const dataUser = await resUser.json();
    if (dataUser.error) {
      userInfoDiv.innerHTML = `‚ùå ${dataUser.error}`;
      return;
    }

    // Ambil avatar dari backend
    const resAvatar = await fetch(`/api/avatar?userId=${dataUser.userId}`);
    const dataAvatar = await resAvatar.json();

    tampilkanUser(dataUser, dataAvatar.avatarUrl);

    lastUserProfileUrl = dataUser.profileUrl;
    lastUserName = dataUser.name;

  } catch (err) {
    console.error(err);
    userInfoDiv.innerHTML = "‚ö†Ô∏è Error mengambil data user!";
  }
}

function tampilkanUser(dataUser, avatarUrl) {
  const userInfoDiv = document.getElementById("userInfo");
  userInfoDiv.innerHTML = `
    <p>‚úÖ Username: <b>${dataUser.name}</b></p>
    <img src="${avatarUrl}" alt="Avatar Roblox" style="width:100px;border-radius:8px;border:1px solid #000;">
    <p><a href="${dataUser.profileUrl}" target="_blank">üîó Lihat Profil</a></p>
  `;
}

// üöÄ Konfirmasi WA
function konfirmasiWA() {
  const username = document.getElementById('username').value.trim();
  const robux = document.getElementById('jumlahRobux').value;

  if (!username || !robux) {
    document.getElementById('notifError').style.display = "block";
    setTimeout(() => { document.getElementById('notifError').style.display = "none"; }, 4000);
    return;
  }

  document.getElementById('confirmUser').innerText = username;
  document.getElementById('confirmRobux').innerText = robux;
  document.getElementById('notifConfirm').style.display = "block";
}

function batalConfirm() {
  document.getElementById('notifConfirm').style.display = "none";
}

function lanjutkanWA() {
  document.getElementById('notifConfirm').style.display = "none";

  const username = document.getElementById('username').value.trim();
  const robux = document.getElementById('jumlahRobux').value;
  const total = document.getElementById('totalRp').value;
  const gamepass = document.getElementById('gamepassInfo').innerText;
  const profileLink = lastUserProfileUrl || "";

  const message = `Halo Admin Dexblox,
Topup ${robux} Robux (${total}) untuk ${username}.
${gamepass}
Profil User: ${profileLink}
Pembayaran via QRIS. Bukti pembayaran sudah dikirim user.`;

  const phone = "6285362187740";
  const waUrl = `https://wa.me/${phone}?text=${encodeURIComponent(message)}`;
  window.open(waUrl, "_blank");

  const notifSuccess = document.getElementById('topupNotif');
  notifSuccess.innerText = "‚úÖ Topup kamu sedang diproses! Admin Dexblox akan segera kirim Robux.";
  notifSuccess.style.display = "block";
  setTimeout(() => { notifSuccess.style.display = "none"; }, 5000);
}

// üîë Admin Panel
function toggleAdmin() {
  const panel = document.getElementById('adminPanelBox');
  panel.style.display = panel.style.display === "none" ? "block" : "none";
}
function adminLogin() {
  const pass = document.getElementById('adminPass').value;
  const result = document.getElementById('adminResult');
  if (pass === "dexblox123") {
    result.innerText = "‚úÖ Login sukses!";
    document.getElementById('adminPanel').style.display = "block";
  } else {
    result.innerText = "‚ùå Kode salah!";
  }
}
function updatePrice() {
  const newPrice = document.getElementById('newPrice').value;
  if (!newPrice) return;
  localStorage.setItem("hargaPer100", newPrice);
  document.getElementById('hargaPer100').innerText = parseInt(newPrice).toLocaleString();
  alert("‚úÖ Harga berhasil diupdate!");
  hitungManual();
}

// üåø Efek Partikel Merah Bergerak
const canvasParticles = document.getElementById("particles");
const ctxP = canvasParticles.getContext("2d");
canvasParticles.width = window.innerWidth;
canvasParticles.height = window.innerHeight;
let particlesArray = [];
function initParticles() {
  for (let i = 0; i < 80; i++) {
    particlesArray.push({
      x: Math.random() * canvasParticles.width,
      y: Math.random() * canvasParticles.height,
      radius: Math.random() * 2 + 1,
      dx: (Math.random() - 0.5) * 0.5,
      dy: (Math.random() - 0.5) * 0.5
    });
  }
}
function drawParticles() {
  ctxP.clearRect(0, 0, canvasParticles.width, canvasParticles.height);
  ctxP.fillStyle = "rgba(255,0,0,0.6)";
  ctxP.beginPath();
  particlesArray.forEach(p => {
    ctxP.moveTo(p.x, p.y);
    ctxP.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
  });
  ctxP.fill();
  moveParticles();
}
function moveParticles() {
  particlesArray.forEach(p => {
    p.x += p.dx;
    p.y += p.dy;
    if (p.x < 0 || p.x > canvasParticles.width) p.dx *= -1;
    if (p.y < 0 || p.y > canvasParticles.height) p.dy *= -1;
  });
}
initParticles();
setInterval(drawParticles, 30);
</script>

<footer>
  ¬© 2026 DEXBLOX.ID ‚Äì Semua Hak Cipta
</footer>
</body>
</html>
