<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Topup Robux - Dexblox</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {margin:0;font-family:'Poppins',sans-serif;background:#fff;color:#000;}
    header, footer {background:rgba(0,0,0,0.8);padding:15px;text-align:center;color:#fff;}
    .container {max-width:95%;margin:20px auto;padding:15px;}
    .panel {margin:15px auto;padding:12px;border-radius:10px;background:transparent;border:1px solid #000;}
    .panel h3 {margin:0 0 10px;font-size:15px;text-align:center;font-weight:600;color:#000;}
    input,button {width:90%;max-width:260px;padding:8px;font-size:13px;border-radius:8px;margin:6px auto;display:block;border:1px solid #000;background:transparent;color:#000;font-weight:600;}
    button:hover {transform:scale(1.05);box-shadow:0 0 12px #000;background:rgba(0,0,0,0.1);}
    .qris {width:100%;border:1px solid #000;border-radius:8px;}
    .info {margin-top:6px;font-size:12px;color:#000;text-align:center;font-weight:bold;}
    #particles {position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:0;}
  </style>
</head>
<body>
  <canvas id="particles"></canvas>
  <header><h1>ğŸ’ Topup Robux - Dexblox</h1></header>

  <main class="container">
    <!-- Username -->
    <section class="panel">
      <h3>ğŸ‘¤ Username Roblox</h3>
      <input type="text" id="username" placeholder="Masukkan Username Roblox">
      <button onclick="cekUsername()">ğŸ” Cek Username</button>
      <div id="userInfo"></div>
    </section>

    <!-- Game -->
    <section class="panel">
      <h3>ğŸ® Cek Game Roblox</h3>
      <input type="text" id="gameId" placeholder="Masukkan Game ID">
      <button onclick="cekGame(document.getElementById('gameId').value)">ğŸ” Cek Game</button>
      <div id="gameInfo"></div>
    </section>

    <!-- Paket -->
    <section class="panel">
      <h3>âš¡ Pilihan Paket Robux</h3>
      <button onclick="pilihPaket(100,'143')">100 RBX</button>
      <button onclick="pilihPaket(300,'429')">300 RBX</button>
      <button onclick="pilihPaket(500,'715')">500 RBX</button>
      <button onclick="pilihPaket(1000,'1430')">1000 RBX</button>
    </section>

    <!-- Manual -->
    <section class="panel">
      <h3>ğŸ’° Jumlah Robux Manual</h3>
      <input type="number" id="jumlahRobux" oninput="hitungManual()">
      <p class="info">Harga: Rp<span id="hargaPer100">11000</span> / 100 RBX</p>
      <p class="info" id="gamepassInfo">Gamepass: -</p>
      <input type="text" id="totalRp" readonly>
    </section>

    <!-- QRIS -->
    <section class="panel">
      <h3>ğŸ’³ Pembayaran QRIS</h3>
      <img src="/qris.png" alt="QRIS Dexblox" class="qris">
    </section>

    <!-- Konfirmasi -->
    <section class="panel">
      <h3>ğŸš€ Konfirmasi Pembelian</h3>
      <button onclick="konfirmasiWA()">Lanjutkan Pembelian</button>
      <div id="topupNotif" style="display:none;">âœ… Topup kamu sedang diproses!</div>
      <div id="notifError" style="display:none;">âŒ Lengkapi Username dan Jumlah Robux!</div>
      <div id="notifConfirm" style="display:none;">
        âš ï¸ Apakah Username <span id="confirmUser"></span> dan Jumlah Robux <span id="confirmRobux"></span> sudah benar?
        <br><br>
        <button onclick="lanjutkanWA()">âœ… Ya, lanjutkan</button>
        <button onclick="batalConfirm()">âŒ Batal</button>
      </div>
    </section>

    <!-- Admin -->
    <section class="panel">
      <h3>ğŸ”‘ Admin Panel</h3>
      <input type="password" id="adminPass" placeholder="Kode admin">
      <button onclick="adminLogin()">Login</button>
      <p id="adminResult"></p>
      <div id="adminPanel" style="display:none;">
        <label for="newPrice">Harga/100 Robux:</label>
        <input type="number" id="newPrice" placeholder="11000">
        <button onclick="updatePrice()">Update</button>
      </div>
    </section>
  </main>

  <footer><p>Â© 2026 Dexblox.ID â€“ Semua Hak Cipta</p></footer>

  <script>
    async function cekUsername() {
      const username = document.getElementById('username').value.trim();
      const userInfoDiv = document.getElementById('userInfo');
      if (!username) {userInfoDiv.innerHTML="âŒ Masukkan username dulu!";return;}
      try {
        const response = await fetch(`/api/user?username=${username}`);
        const data = await response.json();
        if (data.data && data.data.length>0) {
          const user=data.data[0];
          userInfoDiv.innerHTML=`
            âœ… Username: <b>${user.name}</b><br>
            ID: ${user.id}<br>
            <a href="https://www.roblox.com/users/${user.id}/profile" target="_blank">ğŸ”— Profil</a><br>
            <a href="https://www.roblox.com/users/${user.id}/creations" target="_blank">ğŸ  Tempat User</a><br>
            <img src="https://www.roblox.com/headshot-thumbnail/image?userId=${user.id}&width=100&height=100&format=png" style="border-radius:50%;margin-top:6px;">
          `;
        } else {userInfoDiv.innerHTML="âŒ Username tidak ditemukan!";}
      } catch(err){userInfoDiv.innerHTML="âš ï¸ Error koneksi proxy!";}
    }

    async function cekGame(gameId) {
      const gameInfoDiv=document.getElementById('gameInfo');
      if(!gameId){gameInfoDiv.innerHTML="âŒ Masukkan Game ID!";return;}
      try {
        const response=await fetch(`/api/games?gameId=${gameId}`);
        const data=await response.json();
        if(data.data&&data.data.length>0){
          const game=data.data[0];
          gameInfoDiv.innerHTML=`
            ğŸ® Nama Game: <b>${game.name}</b><br>
            ID: ${game.id}<br>
            <a href="https://www.roblox.com/games/${game.id}/${encodeURIComponent(game.name)}" target="_blank">ğŸ”— Lihat Game</a><br>
          `;
        } else {gameInfoDiv.innerHTML="âŒ Game tidak ditemukan!";}
      } catch(err){gameInfoDiv.innerHTML="âš ï¸ Error koneksi proxy!";}
    }

    function pilihPaket(robux,gamepassId){
      const hargaPer100=parseInt(document.getElementById('hargaPer100').innerText.replace(/\./g,''));
      const harga=(robux/100)*hargaPer100;
      document.getElementById('jumlahRobux').value=robux;
      document.getElementById('totalRp').value=`Rp${harga.toLocaleString()}`;
      document.getElementById('gamepassInfo').innerText=`Gamepass: ${gamepassId}`;
    }
    function hitungManual(){
      const robux=parseInt(document.getElementById('jumlahRobux').value);
      if(!robux){document.getElementById('totalRp').value="";document.getElementById('gamepassInfo').innerText="Gamepass: -";return;}
      const hargaPer100=parseInt(document.getElementById('hargaPer100').innerText.replace(/\./g,''));
      const harga=(robux/100)*hargaPer100;
      document.getElementById('totalRp').value=`Rp${harga.toLocaleString()}`;
      document.getElementById('gamepassInfo').innerText=`Gamepass: ${robux}`;
    }

    function konfirmasiWA(){
      const username=document.getElementById('username').value.trim();
      const robux=document.getElementById('jumlahRobux').value;
      if(!username||!robux){
        document.getElementById('notifError').style.display="block";
        setTimeout(()=>{document.getElementById('notifError').style.display="none";},4000);
        return;
      }
      document.getElementById('confirmUser').innerText=username;
      document.getElementById('confirmRobux').innerText=robux;
      document.getElementById('notifConfirm').style.display="block";
    }
    function batalConfirm(){document.getElementById('notifConfirm').style.display="none";}
    function lanjutkanWA(){
      document.getElementById('notifConfirm').style.display="none";
      const username=document.getElementById('username').value.trim();
      const robux=document.getElementById('jumlahRobux').value;
      const total=document.getElementById('totalRp').value;
      const gamepass=document.getElementById('gamepassInfo').innerText;
      const profileLinkEl=document.getElementById('userInfo').querySelector("a[href*='roblox.com/users']");
      const profileLink=profileLinkEl?profileLinkEl.href:"";
      const message=`Halo Admin Dexblox,\nTopup ${robux} Robux (${total}) untuk ${username}.\n${gamepass}\nProfil User: ${profileLink}\nPembayaran via QRIS. Bukti pembayaran sudah dikirim user.`;
      const waUrl=`https://wa.me/6285362187740?text=${encodeURIComponent(message)}`;
      window.open(waUrl,"_blank");
      document.getElementById('topupNotif').style.display="block";
      setTimeout(()=>{document.getElementById('topupNotif').style.display="none";},5000);
    }

    function adminLogin(){
      const pass=document.getElementById('adminPass').value;
      const result=document.getElementById('adminResult');
      if(pass==="dexblox123"){
        result.innerText="âœ… Login sukses!";
        document.getElementById('adminPanel').style.display="block";
      } else {result.innerText="âŒ Kode salah!";}
    }
    function updatePrice(){
      const newPrice=document.getElementById('newPrice').value;
      if(!newPrice)return;
      localStorage.setItem("hargaPer100",newPrice);
      document.getElementById('hargaPer100').innerText=parseInt(newPrice).toLocaleString();
      alert("âœ… Harga berhasil diupdate!");
      hitungManual();
    }

    // background partikel merah
    const canvasParticles=document.getElementById("particles");
    const ctxP=canvasParticles.getContext("2d");
    canvasParticles.width=window.innerWidth;
    canvasParticles.height=window.innerHeight;
    let particlesArray=[];
    function initParticles(){
      for(let i=0;i<80;i++){
        particlesArray.push({
          x:Math.random()*canvasParticles.width,
          y:Math.random()*canvasParticles.height,
          radius:Math.random()*2+1,
          dx:(Math.random()-0.5)*0.5,
          dy:(Math.random()-0.5)*0.5
        });
      }
    }
    function drawParticles(){
      ctxP.clearRect(0,0,canvasParticles.width,canvasParticles.height);
      ctxP.fillStyle="rgba(255,0,0,0.6)";
      ctxP.beginPath();
      particlesArray.forEach(p=>{
        ctxP.moveTo(p.x,p.y);
        ctxP.arc(p.x,p.y,p.radius,0,Math.PI*2);
      });
      ctxP.fill();
      moveParticles();
    }
    function moveParticles(){
      particlesArray.forEach(p=>{
        p.x+=p.dx;p.y+=p.dy;
        if(p.x<0||p.x>canvasParticles.width)p.dx*=-1;
        if(p.y<0||p.y>canvasParticles.height)p.dy*=-1;
      });
    }
    initParticles();
    setInterval(drawParticles,30);
  </script>
</body>
  </html>
