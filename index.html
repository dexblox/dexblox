<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Dexblox Topup Roblox - Cyber Elegan</title>
  <style>
    body {
      margin:0; padding:0;
      font-family: Arial, sans-serif;
      background:#fff;
      color:#333;
      overflow-x:hidden;
    }
    header {
      text-align:center;
      padding:30px;
      font-size:28px;
      color:#007BFF;
      text-shadow:0 0 8px #00f;
      border-bottom:2px solid #e0e0e0;
      position:relative;
      z-index:2;
    }
    .container {
      max-width:700px;
      margin:40px auto;
      padding:20px;
      background:#fff;
      border:1px solid #ddd;
      border-radius:10px;
      box-shadow:0 0 15px rgba(0,123,255,0.2);
      position:relative;
      z-index:2;
    }
    label,input,select,button {
      display:block;
      width:100%;
      margin:10px 0;
      padding:12px;
      font-size:16px;
    }
    button {
      background:#007BFF;
      color:#fff;
      border:none;
      border-radius:5px;
      cursor:pointer;
      transition:0.3s;
    }
    button:hover {
      background:#0056b3;
      box-shadow:0 0 10px #00f;
    }
    img { margin-top:10px; border:2px solid #007BFF; border-radius:8px; }
    table { width:100%; border-collapse:collapse; margin-top:20px; }
    th,td { border:1px solid #007BFF; padding:8px; text-align:left; }
    .admin { margin-top:40px; padding:20px; background:#f5f5f5; border-radius:10px; }
    /* Aurora blue background */
    .aurora-bg {
      position:fixed;
      top:0; left:0;
      width:100%; height:100%;
      background: radial-gradient(circle at 20% 30%, rgba(0,123,255,0.3), transparent 60%),
                  radial-gradient(circle at 80% 70%, rgba(0,200,255,0.3), transparent 60%);
      animation: auroraMove 12s ease-in-out infinite alternate;
      z-index:1;
      opacity:0.6;
    }
    @keyframes auroraMove {
      0% { background-position: 0% 0%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 100%; }
    }
  </style>
</head>
<body>
  <div class="aurora-bg"></div>
  <header>‚ö° Dexblox Topup Roblox ‚ö°</header>

  <div class="container">
    <label for="username">Username Roblox:</label>
    <input type="text" id="username" placeholder="Masukkan username Roblox">
    <button onclick="cekUser()">Cek Username</button>
    <div id="userInfo"></div>

    <label for="package">Pilih Paket Robux:</label>
    <select id="package" onchange="showPackage()"></select>
    <p id="paketInfo"></p>

    <label for="payment">Metode Pembayaran:</label>
    <select id="payment">
      <option value="gopay">GoPay</option>
      <option value="ovo">OVO</option>
      <option value="dana">DANA</option>
      <option value="qris">QRIS</option>
    </select>

    <button onclick="topup()">Topup Sekarang</button>
    <p id="result"></p>
  </div>

  <!-- Admin Panel -->
  <div class="container admin">
    <h3>üîë Admin Panel</h3>
    <input type="text" id="adminUser" placeholder="Username">
    <input type="password" id="adminPass" placeholder="Password">
    <button onclick="adminLogin()">Login</button>
    <p id="adminResult"></p>

    <div id="adminPanel" style="display:none;">
      <label for="editPackage">Pilih Paket:</label>
      <select id="editPackage"></select>
      <label for="newPrice">Harga Baru (Rp):</label>
      <input type="number" id="newPrice">
      <button onclick="updatePrice()">Update Harga</button>
    </div>
  </div>

<script>
  let base = "https://dexblox.vercel.app/api"; 
  let currentUserId = null;

  // Paket Robux default
  let packages = [
    {robux:100, price:11000, setId:143},
    {robux:200, price:22000, setId:286},
    {robux:300, price:33000, setId:429},
    {robux:400, price:44000, setId:572},
    {robux:500, price:55000, setId:715},
    {robux:600, price:66000, setId:858},
    {robux:700, price:77000, setId:1001},
    {robux:800, price:88000, setId:1144},
    {robux:900, price:99000, setId:1287},
    {robux:1000, price:110000, setId:1430}
  ];

  function renderPackages() {
    const pkgSelect = document.getElementById('package');
    pkgSelect.innerHTML = "";
    packages.forEach(p => {
      const opt = document.createElement("option");
      opt.value = p.robux;
      opt.text = `${p.robux} Robux - Rp${p.price.toLocaleString()}`;
      pkgSelect.appendChild(opt);
    });

    const editSelect = document.getElementById('editPackage');
    editSelect.innerHTML = "";
    packages.forEach((p,i) => {
      const opt = document.createElement("option");
      opt.value = i;
      opt.text = `${p.robux} Robux (Set ${p.setId})`;
      editSelect.appendChild(opt);
    });
  }

  function showPackage() {
    const robux = document.getElementById('package').value;
    const pkg = packages.find(p => p.robux == robux);
    document.getElementById('paketInfo').innerText =
      `üì¶ Paket: ${pkg.robux} Robux | üí∞ Rp${pkg.price.toLocaleString()} | üîë Set ID: ${pkg.setId}`;
  }

  async function cekUser() {
    const username = document.getElementById('username').value.trim();
    if (!username) return alert("Isi dulu username!");
    const userInfo = document.getElementById('userInfo');
    userInfo.innerHTML = "Loading...";

    try {
      const res = await fetch(`${base}/user?username=${username}`);
      const data = await res.json();
      const userId = data.Id || data.id || data.data?.[0]?.id;
      if (!userId) throw new Error("UserId tidak ditemukan!");
      currentUserId = userId;

      const avatarRes = await fetch(`${base}/avatar?userId=${userId}`);
      const avatarData = await avatarRes.json();
      const avatarUrl = avatarData.imageUrl || avatarData.data?.[0]?.imageUrl;

      userInfo.innerHTML = `
        <p>‚úÖ Username valid: <b>${username}</b> (UserId: ${userId})</p>
        ${avatarUrl ? `<img src="${avatarUrl}" width="150">` : `<p>Avatar tidak ditemukan.</p>`}
      `;
    } catch (err) {
      userInfo.innerHTML = `<p style="color:red;">Error: ${err.message}</p>`;
    }
  }

  function topup() {
    const username = document.getElementById('username').value.trim();
    const robux = document.getElementById('package').value;
    const pkg = packages.find(p => p.robux == robux);
    const payment = document.getElementById('payment').value;
    if (!currentUserId) return alert("Cek username dulu sebelum topup!");
    document.getElementById('result').innerText =
      `‚úÖ Topup ${pkg.robux} Robux (Rp${pkg.price.toLocaleString()}, Set ${pkg.setId}) untuk ${username} via ${payment} sedang diproses...`;
  }

  function adminLogin() {
    const user = document.getElementById('adminUser').value;
    const pass = document.getElementById('adminPass').value;
    if (user === "admin" && pass === "12345") {
      document.getElementById('adminResult').innerText = "‚úÖ Login berhasil. Selamat datang Admin!";
      document.getElementById('adminPanel').style.display = "block";
    } else {
      document.getElementById('adminResult').innerText = "‚ùå Login gagal.";
    }
  }

  function updatePrice() {
    const idx = document.getElementById('editPackage').value;
    const newPrice = parseInt(document.getElementById('newPrice').value);
    if (!newPrice) return alert("Isi harga baru!");
    packages[idx].price = newPrice;
    renderPackages();
    alert(`Harga paket ${packages[idx].robux} Robux diupdate jadi Rp${newPrice.toLocaleString()}`);
  }

  // init render paket
  renderPackages();
  document.getElementById('package').addEventListener("change", showPackage);
  showPackage();
</script>
</body>
</html>
